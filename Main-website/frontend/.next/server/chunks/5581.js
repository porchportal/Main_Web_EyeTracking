"use strict";exports.id=5581,exports.ids=[5581],exports.modules={5581:(a,b,c)=>{c.r(b),c.d(b,{default:()=>i});var d=c(8732),e=c(2015),f=c(9501),g=c.n(f);c(3203);let h=({isShowing:a,onClose:b,onCameraReady:c,showHeadPose:f=!1,showBoundingBox:g=!1,showMask:h=!1,showParameters:i=!1})=>{let j=(0,e.useRef)(null),k=(0,e.useRef)(null),l=(0,e.useRef)(null),m=(0,e.useRef)(null),[n,o]=(0,e.useState)(null),[p,q]=(0,e.useState)(""),[r,s]=(0,e.useState)(0),t=(0,e.useRef)(null),u=(0,e.useRef)(null),[v,w]=(0,e.useState)({width:0,height:0}),[x,y]=(0,e.useState)(!1),[z,A]=(0,e.useState)(null);(0,e.useRef)([]),(0,e.useRef)(!1);let[B,C]=(0,e.useState)("disconnected"),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)(!1),H=()=>{m.current&&(m.current.close(1e3,"User requested disconnect"),m.current=null,C("disconnected"),E(!1),u.current&&(clearInterval(u.current),u.current=null),k.current&&k.current.getContext("2d").clearRect(0,0,k.current.width,k.current.height))};(0,e.useEffect)(()=>a?()=>{H()}:void H(),[a]);let I=()=>{if(!j.current||!k.current||!x||!m.current)return;let a=j.current,b=k.current,c=b.getContext("2d");m.current&&m.current.readyState===WebSocket.OPEN&&(c.clearRect(0,0,b.width,b.height),c.save(),c.translate(b.width,0),c.scale(-1,1),c.drawImage(a,0,0,b.width,b.height),c.restore(),b.toBlob(a=>{a&&m.current&&m.current.readyState===WebSocket.OPEN&&m.current.send(a)},"image/jpeg",.95))},J=async()=>{q(""),y(!1),G(!0),u.current&&(clearInterval(u.current),u.current=null);try{throw Error("Window object not available - not running in a browser environment")}catch(b){console.error("Camera access error:",b);let a="Camera error: ";"NotAllowedError"===b.name?a+="Camera access was denied. Please allow camera access in your browser settings.":"NotFoundError"===b.name?a+="No camera found. Please connect a camera and try again.":"NotReadableError"===b.name?a+="Camera is already in use by another application.":"OverconstrainedError"===b.name?a+="Camera does not support the requested resolution.":"getUserMedia is not implemented in this browser"===b.message?a+="Your browser does not support camera access. Please try using a modern browser like Chrome, Firefox, or Edge.":b.message.includes("HTTPS")?a+="Camera access requires HTTPS or localhost. Please use HTTPS or run the application on localhost.":b.message.includes("permanently denied")?a+="Camera access has been permanently denied. Please update your browser settings.":b.message.includes("Video loading timeout")?a+="Video took too long to load. Please try again.":a+=b.message||"Unknown error",q(a)}finally{G(!1)}},K=()=>{if(console.log("Stopping camera..."),u.current&&(clearInterval(u.current),u.current=null),n&&(console.log("Stopping stream tracks..."),n.getTracks().forEach(a=>{a.stop(),console.log(`Stopped track: ${a.kind}`)}),o(null)),j.current){let a=j.current;try{a.pause(),a.currentTime=0,a.srcObject=null,a.load(),console.log("Video element reset successfully")}catch(a){console.warn("Error resetting video element:",a)}}k.current&&k.current.getContext("2d").clearRect(0,0,k.current.width,k.current.height),y(!1),q(""),G(!1),console.log("Camera stopped successfully")};(0,e.useEffect)(()=>{let b=!0;return(async()=>{a&&b?(console.log("Starting camera..."),await J()):!a&&b&&(console.log("Stopping camera..."),K())})(),()=>{b=!1,console.log("Component unmounting, cleaning up camera..."),K()}},[a]),(0,e.useEffect)(()=>{if(a)return t.current=setInterval(()=>{s(a=>Math.floor(10*Math.random())+25)},1e3),()=>{t.current&&clearInterval(t.current),u.current&&clearInterval(u.current)}},[a]),(0,e.useEffect)(()=>{if(!a)return;let b=()=>{if(l.current){let{width:a,height:b}=l.current.getBoundingClientRect();w({width:a,height:b})}};return b(),window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[a]),(0,e.useEffect)(()=>{if(!a||!j.current||!n)return;let b=j.current,d=()=>{y(!0);let a=b.videoWidth||640,d=b.videoHeight||480;if(k.current){k.current.width=a,k.current.height=d;let b=a/d,c=v.width;k.current.style.width=`${c}px`,k.current.style.height=`${c/b}px`}L(),c&&c({width:a,height:d})};return b.addEventListener("loadedmetadata",d),()=>{b.removeEventListener("loadedmetadata",d)}},[n,a,v,c]);let L=()=>{if(!k.current||!j.current||!x)return;let a=j.current,b=k.current,c=b.getContext("2d");u.current=setInterval(()=>{if(4!==a.readyState)return;c.clearRect(0,0,b.width,b.height),c.save(),c.translate(b.width,0),c.scale(-1,1),c.drawImage(a,0,0,b.width,b.height),c.restore();let d=Math.random()>.1;d&&(g&&M(c,b),f&&N(c,b),h&&O(c,b)),i&&P(c,b,d)},33)},M=(a,b)=>{let c=b.width/2,d=b.height/2,e=.6*b.width,f=.8*b.height;a.strokeStyle="rgba(255, 255, 0, 0.7)",a.lineWidth=2,a.strokeRect(c-e/2,d-f/2,e,f)},N=(a,b,c,d,e)=>{let f=b.width/2,g=b.height/2,h=Date.now()/1e3,i=.1*b.width;a.beginPath(),a.moveTo(f,g),a.lineTo(f+i*Math.sin(h),g),a.strokeStyle="red",a.lineWidth=3,a.stroke(),a.beginPath(),a.moveTo(f,g),a.lineTo(f,g+i*Math.sin(h+1)),a.strokeStyle="green",a.lineWidth=3,a.stroke(),a.beginPath(),a.moveTo(f,g),a.lineTo(f+i/2*Math.sin(h+2),g-i/2*Math.cos(h+2)),a.strokeStyle="blue",a.lineWidth=3,a.stroke()},O=(a,b,c)=>{let d=b.width/2,e=b.height/2,f=.2*Math.min(b.width,b.height);a.fillStyle="rgba(0, 255, 255, 0.2)",a.beginPath(),a.arc(d,e,f,0,2*Math.PI),a.fill();let g=.2*f,h=.3*f,i=.1*f;a.fillStyle="rgba(255, 255, 255, 0.7)",a.beginPath(),a.arc(d-h,e-i,g,0,2*Math.PI),a.fill(),a.beginPath(),a.arc(d+h,e-i,g,0,2*Math.PI),a.fill()},P=(a,b,c)=>{a.fillStyle="rgba(0, 0, 0, 0.7)",a.fillRect(5,b.height-60,150,50),a.font="12px Arial",a.fillStyle="white",a.fillText(`Resolution: ${b.width}x${b.height}`,10,b.height-40),a.fillText(`FPS: ${r}`,10,b.height-25),a.fillText(`Face: ${c?"Detected":"Not Detected"}`,10,b.height-10)};return a?(0,d.jsxs)("div",{ref:l,style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"30vw",height:"30vh",backgroundColor:"white",borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)",overflow:"hidden",zIndex:1e3},children:[(0,d.jsx)("video",{ref:j,style:{width:"100%",height:"100%",objectFit:"cover",transform:"scaleX(-1)",opacity:x?1:.5,zIndex:1,transition:"opacity 0.3s ease"},playsInline:!0,muted:!0,autoPlay:!1,onLoadedMetadata:()=>{console.log("Video metadata loaded")},onCanPlay:()=>{console.log("Video can play"),j.current&&!x&&j.current.play().catch(a=>{console.log("Auto-play on canplay failed:",a)})},onPlay:()=>{console.log("Video started playing"),y(!0)},onError:a=>{console.error("Video error:",a),q("Video playback error occurred")}}),(0,d.jsx)("canvas",{ref:k,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:2,pointerEvents:"none",display:D?"block":"none"}}),(0,d.jsxs)("div",{style:{position:"absolute",top:"10px",right:"10px",display:"flex",gap:"10px",zIndex:3},children:[(0,d.jsx)("button",{onClick:b,style:{padding:"8px 12px",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.3s ease",zIndex:3},children:"Close"}),(0,d.jsx)("button",{onClick:()=>{D?H():(()=>{if(!m.current||m.current.readyState!==WebSocket.OPEN){C("connecting");try{let a=process.env.NEXT_PUBLIC_WS_URL||"ws://localhost:8010",b=new WebSocket(`${a}/ws/video`);m.current=b;let c=setTimeout(()=>{b.readyState!==WebSocket.OPEN&&(console.error("WebSocket connection timeout"),b.close(),C("error"),q("Connection timeout. Please check if the backend server is running."),E(!1))},5e3);b.onopen=()=>{console.log("WebSocket connected to FastAPI backend"),clearTimeout(c),C("connected"),q(""),E(!0),x&&(u.current=setInterval(I,33))},b.onmessage=a=>{try{let b=JSON.parse(a.data);A(b)}catch(a){console.error("Error parsing WebSocket message:",a)}},b.onerror=a=>{console.error("WebSocket error:",a),clearTimeout(c),C("error"),q("Failed to connect to FastAPI backend. Please check if the server is running."),E(!1)},b.onclose=a=>{console.log("WebSocket disconnected:",a.code,a.reason),clearTimeout(c),C("disconnected"),E(!1),u.current&&(clearInterval(u.current),u.current=null),1e3!==a.code&&q(`WebSocket connection closed: ${a.reason||"Unknown reason"}`)}}catch(a){console.error("Error creating WebSocket:",a),C("error"),q("Failed to create WebSocket connection. Please check your network connection."),E(!1)}}})()},style:{padding:"8px 12px",backgroundColor:D?"rgba(255, 0, 0, 0.7)":"rgba(0, 255, 0, 0.7)",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.3s ease",zIndex:3},children:D?"Unlink":"Link"})]}),F&&(0,d.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",padding:"20px",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",borderRadius:"8px",zIndex:4,textAlign:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"24px",marginBottom:"10px"},children:"\uD83D\uDCF7"}),(0,d.jsx)("div",{children:"Starting camera..."})]}),(p||"error"===B)&&(0,d.jsx)("div",{style:{position:"absolute",top:"50px",right:"10px",padding:"8px 12px",backgroundColor:"rgba(255, 0, 0, 0.8)",color:"white",borderRadius:"4px",zIndex:3,maxWidth:"300px",fontSize:"12px"},children:"error"===B?`Connection Error: ${p}`:p}),(0,d.jsx)("div",{style:{position:"absolute",bottom:"10px",left:"10px",padding:"4px 8px",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",borderRadius:"4px",fontSize:"10px",zIndex:3},children:x?"Camera Ready":F?"Starting...":"Camera Off"})]}):null},i=g()(()=>Promise.resolve(h),{ssr:!1,loading:()=>(0,d.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"480px",height:"360px",background:"#f0f8ff",border:"2px solid #0066cc",borderRadius:"8px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",zIndex:999},children:[(0,d.jsx)("div",{style:{fontSize:"48px",marginBottom:"15px"},children:"\uD83D\uDCF7"}),(0,d.jsx)("p",{style:{fontSize:"16px",fontWeight:"bold",color:"#0066cc"},children:"Loading camera..."})]})})}};