"use strict";exports.id=7438,exports.ids=[7438],exports.modules={5976:(a,b,c)=>{c.r(b),c.d(b,{default:()=>h,useAdminSettings:()=>g});var d=c(2015);let e=(a,b)=>{if(a===b)return!0;if("object"!=typeof a||"object"!=typeof b||null===a||null===b)return!1;let c=Object.keys(a),d=Object.keys(b);return c.length===d.length&&c.every(c=>d.includes(c)&&e(a[c],b[c]))},f=(a,b)=>{},g=a=>{let[b,c]=(0,d.useState)({}),[g,h]=(0,d.useState)(()=>null),[i,j]=(0,d.useState)(!1),[k,l]=(0,d.useState)(null),m=(0,d.useRef)(!1),n=(0,d.useRef)(null),[o,p]=(0,d.useState)({}),[q,r]=(0,d.useState)(0),s=(0,d.useRef)(new Map),t=(0,d.useRef)(new Map),u=(0,d.useRef)(new Map),v=(0,d.useRef)(!1),w=(0,d.useRef)(new Map);(0,d.useEffect)(()=>{console.log("AdminSettings - Current Settings:",b),console.log("AdminSettings - Current User ID:",g),console.log("AdminSettings - Is TopBar Updated:",i)},[b,g,i]);let x=(0,d.useCallback)(async b=>{if(!b)return;let d=s.current.get(b),f=t.current.get(b),g=Date.now();if(d&&f&&g-f<3e4)return console.log("[AdminSettings] Using cached settings for user:",b),d;if(u.current.has(b))return console.log("[AdminSettings] Pending update exists, using cached value"),d;if(v.current)return console.log("[AdminSettings] Update in progress, using cached value"),d;try{v.current=!0,u.current.set(b,!0);let d=await fetch(`/api/data-center/settings/${b}`,{headers:{Accept:"application/json","Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY||"A1B2C3D4-E5F6-7890-GHIJ-KLMNOPQRSTUV"}});if(!d.ok){let a=await d.json().catch(()=>({}));throw Error(a.detail||"Failed to fetch settings")}let f=(await d.json()).data||{},h=w.current.get(b);return e(h,f)?console.log("[AdminSettings] Settings unchanged, skipping update"):(console.log("[AdminSettings] Settings changed, updating..."),c(a=>({...a,[b]:f})),p(f),s.current.set(b,f),t.current.set(b,g),w.current.set(b,f),a&&a.current&&a.current.setCaptureSettings&&(a.current.setCaptureSettings(f),j(!0))),l(null),f}catch(a){return console.error("[AdminSettings] Error fetching settings:",a),l(a.message),d}finally{v.current=!1,u.current.delete(b)}},[a]),y=(0,d.useCallback)(((a,b)=>{let c;return function(...b){clearTimeout(c),c=setTimeout(()=>{clearTimeout(c),a(...b)},1e3)}})(a=>{x(a)},0),[x]);(0,d.useEffect)(()=>{if(!g)return;let a=async()=>{let a=Date.now();if(!(a-q<2e3))try{await y(g),r(a)}catch(a){console.error("[AdminSettings] Polling error:",a)}};return a(),n.current=setInterval(a,5e3),()=>{n.current&&clearInterval(n.current)}},[g,q,y]),(0,d.useEffect)(()=>{let a=a=>{if(a.detail&&a.detail.userId){console.log("[handleUserIdChange] userId:",a.detail.userId);let b=a.detail.userId;h(b),f("currentUserId",b),x(b)}};return window.addEventListener("userIdChange",a),()=>window.removeEventListener("userIdChange",a)},[a]),(0,d.useEffect)(()=>{g&&!m.current&&(x(g),m.current=!0)},[g]),(0,d.useEffect)(()=>{if(i){let a=new CustomEvent("settingsUpdated",{detail:{type:"settings",userId:g,settings:b[g]}});window.dispatchEvent(a),j(!1)}},[i,g,b]),(0,d.useEffect)(()=>{try{let a=null;if(a){let b=JSON.parse(a);c(b)}}catch(a){console.warn("Error loading settings from localStorage:",a)}},[]),(0,d.useEffect)(()=>{if(m.current)try{f("adminSettings",JSON.stringify(b))}catch(a){console.warn("Error saving settings to localStorage:",a)}else m.current=!0},[b]),(0,d.useEffect)(()=>{if(b&&g){console.log("[settings useEffect] currentUserId:",g);let a=b[g];a&&p(a)}},[b,g]),(0,d.useEffect)(()=>{let a=a=>{if(a.detail&&"captureSettings"===a.detail.type){let{userId:b,times_set_random:d,delay_set_random:e}=a.detail;if(console.log("[handleSettingsUpdate] userId:",b,"currentUserId:",g,"times_set_random:",d,"delay_set_random:",e),b===g){let a={...o,times_set_random:void 0!==d?Number(d):o.times_set_random,delay_set_random:void 0!==e?Number(e):o.delay_set_random};console.log("[handleSettingsUpdate] Updated settings:",a),p(a),c(c=>({...c,[b]:a})),z(a,b)}}};return window.addEventListener("captureSettingsUpdate",a),()=>window.removeEventListener("captureSettingsUpdate",a)},[g,o]);let z=(0,d.useCallback)(async(a,d)=>{if(!d)return;let f=Date.now();if(f-q<2e3)return void console.log("[updateSettings] Skipping update - too soon after last update");let g={...b[d],...a};if(e(w.current.get(d),g))return void console.log("[updateSettings] Settings unchanged, skipping update");try{v.current=!0,u.current.set(d,!0);let a=await fetch(`http://localhost:80/api/data-center/settings/${d}`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY||"A1B2C3D4-E5F6-7890-GHIJ-KLMNOPQRSTUV"},body:JSON.stringify(g)});if(!a.ok){let b=await a.json().catch(()=>({}));throw Error(b.detail||"Failed to save settings")}let b=(await a.json()).data||g;c(a=>({...a,[d]:b})),p(b),s.current.set(d,b),t.current.set(d,f),w.current.set(d,b),r(f),l(null)}catch(a){l(a.message)}finally{v.current=!1,u.current.delete(d)}},[b,q]);return{settings:b,currentSettings:o,currentUserId:g,error:k,updateSettings:x}};function h(){return null}},7438:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>m});var e=c(8732),f=c(7085),g=c.n(f),h=c(2015),i=c(4233),j=c(5976),k=c(6100),l=a([k]);k=(l.then?(await l)():l)[0];let m=({onButtonClick:a,onCameraAccess:b,outputText:c,onOutputChange:d,onToggleTopBar:f,onToggleMetrics:l,canvasRef:m,isTopBarShown:n=!0,isCanvasVisible:o=!0,showMetrics:p=!0})=>{let q=(0,i.useRouter)(),[r,s]=(0,h.useState)(o),{settings:t,updateSettings:u}=(0,j.useAdminSettings)(),[v,w]=(0,h.useState)(null),[x,y]=(0,h.useState)(!0),[z,A]=(0,h.useState)({times_set_random:1,delay_set_random:3}),B=(0,h.useRef)(!1),C=(0,h.useCallback)(async a=>{if(a&&!B.current)try{B.current=!0,console.log(`[TopBar] Fetching settings for user: ${a}`);let b=await fetch(`/api/data-center/settings/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY}});if(!b.ok)throw Error("Failed to fetch settings");let c=(await b.json()).data||{};if(console.log(`[TopBar] Retrieved settings for user ${a}:`,c),c&&(void 0!==c.times_set_random||void 0!==c.delay_set_random)){A(c),u&&await u(c,a);let b=new CustomEvent("topBarSettingsLoaded",{detail:{userId:a,times_set_random:c.times_set_random,delay_set_random:c.delay_set_random,settings:c}});window.dispatchEvent(b)}}catch(a){console.error("TopBar - Error fetching settings:",a)}finally{B.current=!1}},[u]),D=(0,h.useCallback)(((a,b)=>{let c,d,e;return function(...b){d=b,e=this,c&&clearTimeout(c),c=setTimeout(()=>{c=null,a.apply(e,d)},500)}})(async(a,b)=>{if(a&&!B.current)try{B.current=!0;let c=await fetch(`/api/data-center/settings/${a}`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY},body:JSON.stringify(b)});if(!c.ok)throw Error("Failed to save settings to backend");let d=await c.json();A(d),u&&await u(d,a)}catch(a){console.error("TopBar - Error saving settings:",a)}finally{B.current=!1}},0),[u]);(0,h.useEffect)(()=>{(async()=>{let a=(0,k.qS)();a&&(w(a),await C(a),y(!1))})()},[C]),(0,h.useEffect)(()=>{s(o)},[o]),(0,h.useEffect)(()=>{let a=async a=>{if(a.detail?.userId){let b=a.detail.userId;w(b),await C(b)}};return window.addEventListener("userIdChange",a),()=>window.removeEventListener("userIdChange",a)},[C]),(0,h.useEffect)(()=>{let a=a=>{if(a.detail?.type==="captureSettings"){let{userId:b,times_set_random:c,delay_set_random:d}=a.detail;if(c!==z.times_set_random||d!==z.delay_set_random){let a={times_set_random:Number(c)||z.times_set_random,delay_set_random:Number(d)||z.delay_set_random};D(b,a)}}};return window.addEventListener("captureSettingsUpdate",a),()=>window.removeEventListener("captureSettingsUpdate",a)},[z,D]);let E=b=>{["setRandom","calibrate","randomDot","clearAll"].includes(b)&&console.warn(`Canvas not available for action: ${b}`),a&&a(b)},F=`TopBar ${n?"shown":"hidden"}, Canvas: ${r?"Visible":"Hidden"}`;return(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 topbar",children:[(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 topbar-left",children:[(0,e.jsx)("div",{className:"jsx-8fd840df60237147 logo",children:(0,e.jsx)("h1",{className:"jsx-8fd840df60237147 logo-text",children:"Logo"})}),(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 controls-container",children:[(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 control-group",children:[(0,e.jsx)("span",{className:"jsx-8fd840df60237147 control-label",children:"Time(s):"}),(0,e.jsx)("div",{className:"jsx-8fd840df60237147 control-input",children:(0,e.jsx)("span",{className:"jsx-8fd840df60237147 control-input-field",children:z.times_set_random})})]},`times-${z.times_set_random}-${Date.now()}`),(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 control-group",children:[(0,e.jsx)("span",{className:"jsx-8fd840df60237147 control-label",children:"Delay(s):"}),(0,e.jsx)("div",{className:"jsx-8fd840df60237147 control-input",children:(0,e.jsx)("span",{className:"jsx-8fd840df60237147 control-input-field",children:z.delay_set_random})})]},`delay-${z.delay_set_random}-${Date.now()}`)]})]}),(0,e.jsx)("div",{className:"jsx-8fd840df60237147 topbar-middle",children:(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 button-groups",children:[(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 button-group",children:[(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 button-row",children:[(0,e.jsx)("button",{onClick:()=>{q.push("/")},title:"Go back to home page",className:"jsx-8fd840df60237147 btn back-button",children:"← Back"}),(0,e.jsx)("button",{onClick:()=>E("setRandom"),className:"jsx-8fd840df60237147 btn",children:"Set Random"}),(0,e.jsx)("button",{onClick:()=>E("calibrate"),className:"jsx-8fd840df60237147 btn",children:"Set Calibrate"})]}),(0,e.jsxs)("div",{style:{marginRight:"80px"},className:"jsx-8fd840df60237147 button-row",children:[(0,e.jsx)("button",{onClick:()=>E("randomDot"),className:"jsx-8fd840df60237147 btn",children:"Random Dot"}),(0,e.jsx)("button",{onClick:()=>E("clearAll"),className:"jsx-8fd840df60237147 btn",children:"Clear All"})]})]}),(0,e.jsx)("div",{className:"jsx-8fd840df60237147 topbar-divider"}),(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 button-group",children:[(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 button-row",children:[(0,e.jsx)("button",{onClick:()=>E("headPose"),className:"jsx-8fd840df60237147 btn",children:"Draw Head pose"}),(0,e.jsx)("button",{onClick:()=>E("boundingBox"),className:"jsx-8fd840df60237147 btn",children:"Show Bounding Box"})]}),(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 button-row",children:[(0,e.jsx)("button",{onClick:()=>E("preview"),className:"jsx-8fd840df60237147 btn",children:"Show Preview"}),(0,e.jsx)("button",{onClick:()=>E("mask"),className:"jsx-8fd840df60237147 btn",children:"\uD83D\uDE0A Show Mask"}),(0,e.jsx)("button",{onClick:()=>E("parameters"),className:"jsx-8fd840df60237147 btn",children:"Parameters"})]})]})]})}),(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 topbar-right",children:[(0,e.jsx)("div",{className:"jsx-8fd840df60237147 notes-container",children:(0,e.jsxs)("div",{title:"Processing Output",className:"jsx-8fd840df60237147 output-display",children:[F,(0,e.jsx)("br",{className:"jsx-8fd840df60237147"}),c||"Processing output will appear here..."]})}),(0,e.jsxs)("div",{className:"jsx-8fd840df60237147 control-buttons",children:[(0,e.jsx)("button",{onClick:()=>{f(!n)},title:"Toggle TopBar",style:{padding:"5px 10px",backgroundColor:"#0066cc",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",marginRight:"5px"},className:"jsx-8fd840df60237147 icon-btn menu-btn",children:(0,e.jsx)("span",{className:"jsx-8fd840df60237147 icon-text",children:"≡"})}),(0,e.jsx)("button",{onClick:()=>{console.log("TopBar: handleToggleMetrics called"),a?(console.log("TopBar: Using action handler for metrics"),a("metrics")):(console.log("TopBar: Using direct toggle for metrics"),l())},title:`${p?"Hide":"Show"} Metrics`,style:{padding:"5px 10px",backgroundColor:p?"#00cc00":"#ff9900",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer",transition:"all 0.2s ease"},className:"jsx-8fd840df60237147 icon-btn alert-btn",children:(0,e.jsx)("span",{className:"jsx-8fd840df60237147 icon-text",children:p?"✓":"!"})})]})]}),(0,e.jsx)(g(),{id:"8fd840df60237147",children:".active-toggle.jsx-8fd840df60237147{transform:scale(1.2);transition:all.3s ease}.icon-btn.jsx-8fd840df60237147{transition:all.2s ease}.icon-btn.jsx-8fd840df60237147:hover{opacity:.8}"})]})};d()}catch(a){d(a)}})}};