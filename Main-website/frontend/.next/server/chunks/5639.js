"use strict";exports.id=5639,exports.ids=[5639],exports.modules={5639:(a,b,c)=>{c.d(b,{default:()=>g}),c(2015);var d=c(3453),e=c(3203);class f{constructor(a){this.handleAction=async()=>{try{let a=document.querySelector('.control-input-field[data-control="time"]'),b=document.querySelector('.control-input-field[data-control="delay"]'),c=1,f=3;if(a){let b=parseInt(a.value,10);!isNaN(b)&&b>0&&(c=b)}if(b){let a=parseInt(b.value,10);!isNaN(a)&&a>0&&(f=a)}this.toggleTopBar&&this.toggleTopBar(!1),"function"==typeof this.setIsCapturing&&this.setIsCapturing(!0),this.onStatusUpdate?.({processStatus:`Starting ${c} random captures with ${f}s delay...`,isCapturing:!0,remainingCaptures:c});let g=await this.waitForCanvas();this.enterFullscreen();let h=0,i=1;for(;i<=c;){this.onStatusUpdate?.({processStatus:`Capture ${i} of ${c}`,remainingCaptures:c-i+1,isCapturing:!0}),this.clearCanvas();let a=(0,d.b)(g,20);this.drawDot(a.x,a.y,12);let b=setInterval(()=>{this.drawDot(a.x,a.y,12)},200);if(await new Promise(b=>{(0,d.rd)(a,g,a=>{a.processStatus&&this.onStatusUpdate?.({processStatus:`Capture ${i}/${c}: ${a.processStatus}`,remainingCaptures:c-i+1,isCapturing:!0})},b)}),clearInterval(b),this.triggerCameraAccess)try{this.triggerCameraAccess(!0)||console.warn("Camera access failed, but continuing with capture")}catch(a){console.warn("Camera access error, but continuing with capture:",a)}await new Promise(a=>setTimeout(a,500));try{let b=await (0,e.Wo)({point:a,captureCount:this.captureCounter,canvasRef:{current:g},setCaptureCount:this.setCaptureCounter,showCapturePreview:d.Wj});b&&(b.screenImage||b.success)&&h++,this.setCaptureCounter&&this.setCaptureCounter(a=>a+1)}catch(a){console.error(`Error capturing point ${i}:`,a)}i<c&&(this.onStatusUpdate?.({processStatus:`Waiting ${f}s before next capture...`,remainingCaptures:c-i,isCapturing:!0}),await new Promise(a=>setTimeout(a,1e3*f))),i++}this.onStatusUpdate?.({processStatus:`Random capture sequence completed: ${h}/${c} captures successful`,remainingCaptures:0,isCapturing:!1}),"function"==typeof this.setIsCapturing&&this.setIsCapturing(!1),this.clearCanvas(),this.exitFullscreen(),this.toggleTopBar&&this.toggleTopBar(!0)}catch(a){console.error("Random sequence error:",a),this.onStatusUpdate?.({processStatus:`Random sequence failed: ${a.message}`,isCapturing:!1,remainingCaptures:0}),"function"==typeof this.setIsCapturing&&this.setIsCapturing(!1),this.toggleTopBar&&this.toggleTopBar(!0)}},this.canvasRef=a.canvasRef,this.onStatusUpdate=a.onStatusUpdate,this.setCaptureCounter=a.setCaptureCounter,this.toggleTopBar=a.toggleTopBar,this.captureCounter=a.captureCounter||1,this.triggerCameraAccess=a.triggerCameraAccess,this.setIsCapturing=a.setIsCapturing,this.setProcessStatus=a.setProcessStatus,this.canvasManager=null,this.canvasUtils=null}getCanvas(){return this.canvasUtils&&"function"==typeof this.canvasUtils.getCanvas?this.canvasUtils.getCanvas():this.canvasManager&&"function"==typeof this.canvasManager.getCanvas?this.canvasManager.getCanvas()||this.canvasManager.createCanvas():this.canvasRef?.current||document.querySelector("#tracking-canvas")}enterFullscreen(){if(this.canvasUtils&&"function"==typeof this.canvasUtils.enterFullscreen)return this.canvasUtils.enterFullscreen();if(this.canvasManager&&"function"==typeof this.canvasManager.enterFullscreen)return this.canvasManager.enterFullscreen(),this.canvasManager.getCanvas();let a=this.getCanvas();if(a){document.body.appendChild(a),a.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 99999;
        background-color: white;
        border: none;
        display: block;
        opacity: 1;
        pointer-events: auto;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      `,a.width=window.innerWidth,a.height=window.innerHeight;let b=a.getContext("2d");b.fillStyle="white",b.fillRect(0,0,a.width,a.height)}return a}exitFullscreen(){if(this.canvasUtils&&"function"==typeof this.canvasUtils.exitFullscreen)return this.canvasUtils.exitFullscreen();if(this.canvasManager&&"function"==typeof this.canvasManager.exitFullscreen)return this.canvasManager.exitFullscreen(),this.canvasManager.getCanvas();let a=this.getCanvas();return a&&((document.querySelector(".canvas-container")||document.querySelector(".main-content")||document.body).appendChild(a),a.style.position="relative",a.style.top="",a.style.left="",a.style.width="100%",a.style.height="100%",a.style.zIndex="",a.style.backgroundColor="white"),a}clearCanvas(){if(this.canvasUtils&&"function"==typeof this.canvasUtils.clear)return void this.canvasUtils.clear();if(this.canvasManager&&"function"==typeof this.canvasManager.clear)return void this.canvasManager.clear();let a=this.getCanvas();if(a){let b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),b.fillStyle="yellow",b.fillRect(0,0,a.width,a.height)}}drawDot(a,b,c=12){if(this.canvasUtils&&"function"==typeof this.canvasUtils.drawDot)return this.canvasUtils.drawDot(a,b,c);let e=this.getCanvas();if(e){let f=e.getContext("2d");return(0,d.Pt)(f,a,b,c,!1),!0}return!1}async waitForCanvas(a=20,b=100){for(let c=0;c<a;c++){let a=this.getCanvas();if(a&&a.width>0&&a.height>0)return a;await new Promise(a=>setTimeout(a,b))}throw Error("Canvas not ready after multiple attempts")}}let g=f}};