"use strict";exports.id=7886,exports.ids=[7886],exports.modules={7886:(a,b,c)=>{c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(2015);let f=()=>{let{isProcessing:a,processingResults:b,processingError:c,backendAvailable:f,videoRef:g,canvasRef:h,options:i,startVideoProcessing:j,stopVideoProcessing:k,toggleVideoProcessing:l,updateOptions:m}=(()=>{let[a,b]=(0,e.useState)(!1),[c,d]=(0,e.useState)(null),[f,g]=(0,e.useState)(null),[h,i]=(0,e.useState)(null),j=(0,e.useRef)(null),k=(0,e.useRef)(null),l=(0,e.useRef)(null),m=(0,e.useRef)(null),[n,o]=(0,e.useState)({showHeadPose:!1,showBoundingBox:!1,showMask:!1,showParameters:!1,showProcessedImage:!1});(0,e.useEffect)(()=>{(async()=>{try{let a=await fetch("/api/check-backend-connection"),b=await a.json();i(b.connected),console.log(`Backend connection: ${b.connected?"OK":"Failed"}`)}catch(a){console.error("Error checking backend connection:",a),i(!1)}})()},[]);let p=(0,e.useCallback)(async(c={})=>{if(a)return void q(c);g(null),q(c);try{let a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});if(k.current=a,j.current){j.current.srcObject=a;try{await j.current.play(),console.log("Video playing successfully")}catch(a){console.error("Error playing video:",a),g(`Failed to play video: ${a.message}`),r();return}}b(!0),l.current=setInterval(()=>{t()},200)}catch(a){console.error("Error starting video processing:",a),g(`Failed to access camera: ${a.message}`),r()}},[a]),q=(0,e.useCallback)((a={})=>{o(b=>({...b,...a}))},[]),r=(0,e.useCallback)(()=>{l.current&&(clearInterval(l.current),l.current=null),k.current&&(k.current.getTracks().forEach(a=>{a.stop()}),k.current=null),j.current&&(j.current.srcObject=null),b(!1),d(null)},[]),s=(0,e.useCallback)((b={})=>{a?r():p(b)},[a,p,r]),t=async()=>{if(j.current&&k.current&&a)try{let a=document.createElement("canvas"),b=a.getContext("2d");a.width=j.current.videoWidth,a.height=j.current.videoHeight,b.drawImage(j.current,0,0,a.width,a.height);let c=await new Promise(b=>{a.toBlob(b,"image/jpeg",.8)});if(!c)return void console.error("Failed to capture frame");let e=new FormData;e.append("file",c,"frame.jpg"),e.append("showHeadPose",n.showHeadPose.toString()),e.append("showBoundingBox",n.showBoundingBox.toString()),e.append("showMask",n.showMask.toString()),e.append("showParameters",n.showParameters.toString());let f=await fetch("/api/process-frame",{method:"POST",body:e});if(!f.ok)throw Error(`Server error: ${f.status}`);let g=await f.json();if(g.success)return d(g),g.image&&n.showProcessedImage&&m.current&&u(g.image,m.current),g;return console.error("Processing failed:",g.error),null}catch(a){return console.error("Error processing frame:",a),g(`Processing error: ${a.message}`),null}},u=(a,b)=>{if(!b||!a)return;let c=b.getContext("2d"),d=new Image;d.onload=()=>{c.clearRect(0,0,b.width,b.height),c.drawImage(d,0,0,b.width,b.height)},d.src=`data:image/jpeg;base64,${a}`};return{isProcessing:a,processingResults:c,processingError:f,backendAvailable:h,videoRef:j,canvasRef:m,options:n,startVideoProcessing:p,stopVideoProcessing:r,toggleVideoProcessing:s,updateOptions:q,processCurrentFrame:t}})();return(0,d.jsxs)("div",{className:"video-processor-container",children:[(0,d.jsxs)("div",{className:"video-container relative",children:[(0,d.jsx)("video",{ref:g,className:"w-full max-w-2xl mx-auto rounded-lg shadow-lg",style:{display:a?"block":"none",aspectRatio:"16/9",backgroundColor:"#000"},playsInline:!0}),(0,d.jsx)("canvas",{ref:h,className:"w-full max-w-2xl mx-auto rounded-lg shadow-lg",style:{display:a?"block":"none",aspectRatio:"16/9",backgroundColor:"#000"}}),(0,d.jsx)("div",{className:"absolute top-4 right-4 space-x-2",children:(0,d.jsx)("button",{onClick:()=>l(),className:`px-4 py-2 rounded-lg font-medium ${a?"bg-red-500 hover:bg-red-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}`,children:a?"Stop":"Start"})})]}),c&&(0,d.jsxs)("div",{className:"mt-4 p-4 bg-red-100 text-red-700 rounded-lg",children:["Error: ",c]}),!1===f&&(0,d.jsx)("div",{className:"mt-4 p-4 bg-yellow-100 text-yellow-700 rounded-lg",children:"Backend connection not available"}),(0,d.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:i.showHeadPose,onChange:a=>m({showHeadPose:a.target.checked}),className:"form-checkbox"}),(0,d.jsx)("span",{children:"Show Head Pose"})]}),(0,d.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:i.showBoundingBox,onChange:a=>m({showBoundingBox:a.target.checked}),className:"form-checkbox"}),(0,d.jsx)("span",{children:"Show Bounding Box"})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,d.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:i.showMask,onChange:a=>m({showMask:a.target.checked}),className:"form-checkbox"}),(0,d.jsx)("span",{children:"Show Mask"})]}),(0,d.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,d.jsx)("input",{type:"checkbox",checked:i.showParameters,onChange:a=>m({showParameters:a.target.checked}),className:"form-checkbox"}),(0,d.jsx)("span",{children:"Show Parameters"})]})]})]}),b&&i.showParameters&&(0,d.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg",children:[(0,d.jsx)("h3",{className:"font-medium mb-2",children:"Processing Results:"}),(0,d.jsx)("pre",{className:"text-sm overflow-auto",children:JSON.stringify(b,null,2)})]})]})}}};