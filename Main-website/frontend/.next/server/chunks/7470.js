exports.id=7470,exports.ids=[7470],exports.modules={60:(a,b,c)=>{"use strict";c.r(b),c.d(b,{calibrationCapture:()=>k,captureAndPreviewProcess:()=>l,captureImages:()=>i,createCountdownElement:()=>e,drawRedDot:()=>h,getRandomPosition:()=>j,runCountdown:()=>g,showCapturePreview:()=>f});var d=c(1729);let e=(a,b)=>{if(!a||"number"!=typeof a.x||"number"!=typeof a.y)return console.warn("[createCountdownElement] Invalid position:",a),null;document.querySelectorAll(".calibrate-countdown, .forced-countdown, .center-countdown-backup").forEach(a=>a.remove());let c=b.left+a.x,d=b.top+a.y,e=document.createElement("div");return e.className="dot-countdown",e.style.cssText=`
    position: fixed;
    left: ${c}px;
    top: ${d-60}px;
    transform: translateX(-50%);
    color: red;
    font-size: 36px;
    font-weight: bold;
    text-shadow: 0 0 10px white, 0 0 20px white;
    z-index: 9999;
    background-color: rgba(255, 255, 255, 0.8);
    border: 2px solid red;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
  `,document.body.appendChild(e),e},f=(a,b,c)=>{if(!a&&!b)return;document.querySelectorAll(".capture-preview-container").forEach(a=>{a.parentNode&&a.parentNode.removeChild(a)});let d=document.createElement("div");if(d.className="capture-preview-container",d.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    gap: 20px;
    background-color: rgba(0, 0, 0, 0.85);
    padding: 20px;
    border-radius: 12px;
    z-index: 999999;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
  `,a){let b=document.createElement("div");b.style.cssText=`
      display: flex;
      flex-direction: column;
      align-items: center;
    `;let c=document.createElement("img");c.src=a,c.alt="Screen Capture",c.style.cssText=`
      max-width: 320px;
      max-height: 240px;
      border: 3px solid white;
      border-radius: 8px;
      background-color: #333;
    `;let e=document.createElement("div");e.textContent="Screen Capture",e.style.cssText=`
      color: white;
      font-size: 14px;
      margin-top: 10px;
      font-weight: bold;
    `,b.appendChild(c),b.appendChild(e),d.appendChild(b)}if(b){let a=document.createElement("div");a.style.cssText=`
      display: flex;
      flex-direction: column;
      align-items: center;
    `;let c=document.createElement("img");c.src=b,c.alt="Webcam Capture",c.style.cssText=`
      max-width: 320px;
      max-height: 240px;
      border: 3px solid white;
      border-radius: 8px;
      background-color: #333;
    `;let e=document.createElement("div");e.textContent="Webcam Capture",e.style.cssText=`
      color: white;
      font-size: 14px;
      margin-top: 10px;
      font-weight: bold;
    `,a.appendChild(c),a.appendChild(e),d.appendChild(a)}if(c){let a=document.createElement("div");a.textContent=c.label?`${c.label}: x=${Math.round(c.x)}, y=${Math.round(c.y)}`:`Point: x=${Math.round(c.x)}, y=${Math.round(c.y)}`,a.style.cssText=`
      color: #ffcc00;
      font-size: 14px;
      position: absolute;
      top: -40px;
      left: 0;
      width: 100%;
      text-align: center;
    `,d.appendChild(a)}let e=document.createElement("div");e.textContent="2.0s",e.style.cssText=`
    position: absolute;
    bottom: -25px;
    right: 20px;
    color: white;
    font-size: 12px;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 3px 8px;
    border-radius: 4px;
  `,d.appendChild(e),document.body.appendChild(d);let f=2,g=setInterval(()=>{(f-=.1)<=0?(clearInterval(g),d.style.opacity="0",d.style.transition="opacity 0.3s ease",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},300)):e.textContent=`${f.toFixed(1)}s`},100);setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},5e3)},g=async(a,b,c,d)=>{if(!a||"number"!=typeof a.x||"number"!=typeof a.y){console.warn("[runCountdown] Invalid position:",a),c?.({processStatus:"Invalid dot position",countdownValue:null,isCapturing:!1});return}let f=e(a,b.getBoundingClientRect());if(!f)return void console.warn("[runCountdown] Countdown element could not be created.");let g=b.getContext("2d");h(g,a.x,a.y);let i=3;f.textContent=3,c?.({processStatus:"Countdown",countdownValue:i,isCapturing:!0});let j=setInterval(()=>{h(g,a.x,a.y,12,!1)},200);return new Promise(b=>{let e=setInterval(()=>{--i<=0?(clearInterval(e),f.textContent="✓",c?.({countdownValue:"Capturing...",processStatus:"Capturing image...",isCapturing:!0}),setTimeout(()=>{f.parentNode&&f.parentNode.removeChild(f),h(g,a.x,a.y,12,!1),j&&clearInterval(j),d&&(h(g,a.x,a.y,12,!1),d()),b()},300)):(f.textContent=i,c?.({processStatus:"Countdown",countdownValue:i,isCapturing:!0}))},800)})},h=(a,b,c,d=12,e=!0)=>{let f=a.canvas;return e&&(a.clearRect(0,0,f.width,f.height),a.fillStyle="white",a.fillRect(0,0,f.width,f.height)),a.beginPath(),a.arc(b,c,d,0,2*Math.PI),a.fillStyle="red",a.fill(),a.beginPath(),a.arc(b,c,d+3,0,2*Math.PI),a.strokeStyle="rgba(255, 0, 0, 0.5)",a.lineWidth=3,a.stroke(),a.beginPath(),a.arc(b,c,d+6,0,2*Math.PI),a.strokeStyle="rgba(255, 0, 0, 0.3)",a.lineWidth=2,a.stroke(),{x:b,y:c}},i=async a=>{let{canvasRef:b,position:c,captureCounter:e,setCaptureCounter:g,setProcessStatus:h,toggleTopBar:i,captureFolder:j="eye_tracking_captures"}=a;if(!c||"number"!=typeof c.x||"number"!=typeof c.y)return console.warn("[captureImages] Invalid position object:",c),h?.("Error: Invalid capture position"),null;try{let a=await (0,d.captureImagesAtPoint)({point:c,captureCount:e,canvasRef:b,setCaptureCount:g,showCapturePreview:f});return console.log("Capture successful with ID:",a.captureId),{screenImage:a?.screenImage||"",webcamImage:a?.webcamImage||"",success:!0,captureId:a?.captureId}}catch(a){return console.error("[captureImages] Unexpected error:",a),h?.(`Error: ${a.message}`),{screenImage:"",webcamImage:"",success:!1,error:a.message}}},j=(a,b=40)=>a?{x:Math.floor(Math.random()*((a.width||400)-2*b))+b,y:Math.floor(Math.random()*((a.height||300)-2*b))+b}:{x:100,y:100},k=async a=>{let{canvasRef:b,point:c,captureCounter:d,setCaptureCounter:f,setProcessStatus:g,toggleTopBar:i,captureFolder:j="eye_tracking_captures",pointIndex:k,totalPoints:m}=a;try{console.log(`Starting calibration capture for point ${k+1}/${m}`);let a=b.current;if(!a)return console.error("Canvas reference is null in calibrationCapture"),g?.("Error: Canvas not available"),{success:!1};let n=a.getContext("2d");h(n,c.x,c.y),g?.(`Calibration point ${k+1}/${m}`);let o=a.getBoundingClientRect(),p=e(c,o);if(!p)return console.error("Failed to create countdown element"),{success:!1};let q=setInterval(()=>{h(n,c.x,c.y,12,!1)},200);for(let a=3;a>0;a--)p.textContent=a,g?.(`Point ${k+1}/${m} - countdown ${a}`),h(n,c.x,c.y,12,!1),await new Promise(a=>setTimeout(a,800));p.textContent="✓",setTimeout(()=>{p.parentNode&&p.parentNode.removeChild(p),q&&clearInterval(q)},300);let r=await l({canvasRef:b,position:c,captureCounter:d,setCaptureCounter:f,setProcessStatus:a=>{"string"==typeof a?g?.(a):a&&"object"==typeof a&&g?.(a.processStatus||"")},toggleTopBar:i,onStatusUpdate:a=>{"string"==typeof a?g?.(a):a&&"object"==typeof a&&g?.(a.processStatus||"")},captureFolder:j}),s=r&&"object"==typeof r?r:{screenImage:"",webcamImage:"",success:!1};return{screenImage:s.screenImage||"",webcamImage:s.webcamImage||"",success:!0,point:c}}catch(a){return console.error("Error in calibrationCapture:",a),g?.(`Error: ${a.message}`),{screenImage:"",webcamImage:"",success:!1,error:a.message}}},l=async a=>{let{canvasRef:b,position:c,captureCounter:e,setCaptureCounter:g,setProcessStatus:i,toggleTopBar:j,onStatusUpdate:k,captureFolder:l}=a;try{let a=b?.current;if(!a)return console.error("[captureAndPreviewProcess] Canvas reference is null"),i&&i("Error: Canvas is not available"),null;let l=a.getContext("2d");h(l,c.x,c.y),k&&k({processStatus:"Starting countdown...",isCapturing:!0});let m=a.getBoundingClientRect(),n=document.createElement("div");n.className="calibrate-countdown",n.style.cssText=`
      position: fixed;
      left: ${m.left+c.x}px;
      top: ${m.top+c.y-60}px;
      transform: translateX(-50%);
      color: red;
      font-size: 36px;
      font-weight: bold;
      text-shadow: 0 0 10px white, 0 0 20px white;
      z-index: 9999;
      background-color: rgba(255, 255, 255, 0.8);
      border: 2px solid red;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    `,document.body.appendChild(n);let o=setInterval(()=>{h(l,c.x,c.y,12,!1)},200);for(let a=3;a>0;a--)n.textContent=a,k&&k({processStatus:`Countdown: ${a}`,countdownValue:a,isCapturing:!0}),h(l,c.x,c.y),await new Promise(a=>setTimeout(a,800));n.textContent="✓",k&&k({processStatus:"Capturing images...",countdownValue:"Capturing...",isCapturing:!0}),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),o&&clearInterval(o)},300);let p=await (0,d.captureImagesAtPoint)({point:c,captureCount:e,canvasRef:b,setCaptureCount:g,showCapturePreview:f});return i&&i(`Captured dot at x=${Math.round(c.x)}, y=${Math.round(c.y)}`),k&&k({processStatus:"Capture complete",isCapturing:!1}),setTimeout(()=>{"function"==typeof j&&j(!0)},2500),p}catch(a){return console.error("[captureAndPreviewProcess] Fatal error:",a),i&&i(`Fatal error: ${a.message}`),setTimeout(()=>{"function"==typeof j&&j(!0)},1500),{screenImage:"",webcamImage:"",success:!1,error:a.message}}}},2729:(a,b,c)=>{"use strict";a.exports=c(3885).vendored.contexts.Loadable},4426:(a,b,c)=>{"use strict";c.r(b),c.d(b,{clearCalibrationPoints:()=>k,default:()=>l,drawCalibrationGrid:()=>j,drawCalibrationPoint:()=>h,drawCalibrationPointLegacy:()=>i,generateCalibrationPoints:()=>g}),c(2015);let d=()=>({canvasUtils:null,canvasManager:null}),e=()=>{let{canvasUtils:a,canvasManager:b}=d();return a&&"function"==typeof a.getCanvas?a.getCanvas():b&&"function"==typeof b.getCanvas?b.getCanvas()||b.createCanvas():document.querySelector("#tracking-canvas")},f=()=>{let{canvasUtils:a,canvasManager:b}=d();if(a&&"function"==typeof a.clear)return void a.clear();if(b&&"function"==typeof b.clear)return void b.clear();let c=e();if(c){let a=c.getContext("2d");a.clearRect(0,0,c.width,c.height),a.fillStyle="white",a.fillRect(0,0,c.width,c.height)}},g=(a,b)=>{if(!a||!b||a<=0||b<=0)return console.error("generateCalibrationPoints: Invalid canvas dimensions",{width:a,height:b}),[];let c=(a,b)=>Math.round(a*b),d=c(a,.12),e=a-d,f=c(b,.12),g=b-f,h=c(a,.26),i=a-h,j=c(b,.26),k=b-j,l=Math.floor(a/2),m=Math.floor(b/2);return[{x:d,y:f,label:"Outer Top-Left"},{x:l,y:f,label:"Outer Top-Center"},{x:e,y:f,label:"Outer Top-Right"},{x:d,y:m,label:"Outer Middle-Left"},{x:e,y:m,label:"Outer Middle-Right"},{x:d,y:g,label:"Outer Bottom-Left"},{x:l,y:g,label:"Outer Bottom-Center"},{x:e,y:g,label:"Outer Bottom-Right"},{x:h,y:j,label:"Inner Top-Left"},{x:l,y:j,label:"Inner Top-Center"},{x:i,y:j,label:"Inner Top-Right"},{x:h,y:m,label:"Inner Middle-Left"},{x:i,y:m,label:"Inner Middle-Right"},{x:h,y:k,label:"Inner Bottom-Left"},{x:l,y:k,label:"Inner Bottom-Center"},{x:i,y:k,label:"Inner Bottom-Right"}]},h=(a,b,c={})=>{let f=((a,b,c=12)=>{let{canvasUtils:f}=d();if(f&&"function"==typeof f.drawDot)return f.drawDot(a,b,c);let g=e();return!!g&&(i(g.getContext("2d"),a,b,c),!0)})(a,b,c.radius||12);return{x:a,y:b,success:f}},i=(a,b,c,d=12)=>{if(!a)return{x:b,y:c};let e=a.canvas;return a.clearRect(0,0,e.width,e.height),a.fillStyle="white",a.fillRect(0,0,e.width,e.height),a.beginPath(),a.arc(b,c,d,0,2*Math.PI),a.fillStyle="red",a.fill(),a.beginPath(),a.arc(b,c,d+3,0,2*Math.PI),a.strokeStyle="rgba(255, 0, 0, 0.5)",a.lineWidth=3,a.stroke(),a.beginPath(),a.arc(b,c,d+6,0,2*Math.PI),a.strokeStyle="rgba(255, 0, 0, 0.3)",a.lineWidth=2,a.stroke(),{x:b,y:c}},j=(a,b=-1)=>{if(!a||!a.length)return;let c=e();if(!c)return;let d=c.getContext("2d");if(f(),a.forEach((a,c)=>{let e=c===b,f=e?12:6;d.beginPath(),d.arc(a.x,a.y,f,0,2*Math.PI),d.fillStyle=e?"red":"rgba(0, 102, 204, 0.7)",d.fill(),e&&(d.beginPath(),d.arc(a.x,a.y,f+3,0,2*Math.PI),d.strokeStyle="rgba(255, 0, 0, 0.5)",d.lineWidth=3,d.stroke()),d.fillStyle="white",d.font="10px Arial",d.textAlign="center",d.textBaseline="middle",d.fillText(`${c+1}`,a.x,a.y),e&&a.label&&(d.font="12px Arial",d.fillStyle="black",d.fillText(a.label,a.x,a.y-25))}),a.length>1){d.beginPath(),d.moveTo(a[0].x,a[0].y);for(let b=1;b<a.length;b++)d.lineTo(a[b].x,a[b].y);d.strokeStyle="rgba(0, 102, 204, 0.3)",d.lineWidth=1,d.stroke()}},k=()=>{f()},l=()=>null},7470:(a,b,c)=>{"use strict";c.r(b),c.d(b,{ActionButton:()=>k,ActionButtonGroup:()=>m,default:()=>n});var d=c(8732),e=c(2015),f=c(9501),g=c.n(f);c(4426);var h=c(60),i=c(1729),j=c(4233);let k=({text:a,abbreviatedText:b,onClick:c,customClass:f="",disabled:g=!1,active:h=!1})=>{let[i,j]=(0,e.useState)(!1);return(0,e.useEffect)(()=>{},[]),(0,d.jsx)("button",{onClick:c,className:`transition-colors py-2 px-2 md:px-4 rounded-md text-xs md:text-sm font-medium ${f} ${h?"active-button":""}`,style:{backgroundColor:h?"rgba(0, 102, 204, 0.7)":g?"rgba(200, 200, 200, 0.5)":"rgba(124, 255, 218, 0.5)",color:h?"white":"black",borderRadius:"7px",cursor:g?"not-allowed":"pointer",fontWeight:h?"bold":"normal",boxShadow:h?"0 2px 4px rgba(0,0,0,0.2)":"none"},disabled:g,children:i?b:a})},l=(0,e.forwardRef)(({triggerCameraAccess:a,isCompactMode:b,onActionClick:f},g)=>{let l=(0,j.useRouter)(),[m,n]=(0,e.useState)(1),[o,p]=(0,e.useState)(3),q=(0,e.useRef)(null),[r,s]=(0,e.useState)(""),[t,u]=(0,e.useState)(null),[v,w]=(0,e.useState)(null),[x,y]=(0,e.useState)([]),[z,A]=(0,e.useState)(0),[B,C]=(0,e.useState)(0),[D,E]=(0,e.useState)(!0),[F,G]=(0,e.useState)(null),[H,I]=(0,e.useState)(1),[J,K]=(0,e.useState)(!1),[L,M]=(0,e.useState)(!1),[N,O]=(0,e.useState)(!1),[P,Q]=(0,e.useState)(!1),[R,S]=(0,e.useState)(!1),[T,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(!1);(0,e.useImperativeHandle)(g,()=>({handleRandomDot:_,handleSetRandom:Z,handleSetCalibrate:$,handleClearAll:aa}),[]),(0,e.useEffect)(()=>()=>{},[]),(0,e.useEffect)(()=>{},[]);let X=()=>{if(q.current)return q.current;if("undefined"!=typeof document){let a=document.querySelector(".tracking-canvas");if(a)return q.current=a,a}return null},Y=async a=>{let{position:b,onStatusUpdate:c,toggleTopBar:d,triggerCameraAccess:e,setIsCapturing:f,captureCount:g,setCaptureCount:j,useRandomPosition:k=!1,postCountdownDelay:l=500}=a;try{"function"==typeof d&&d(!1),f(!0),c?.({processStatus:k?"Generating random dot...":"Starting dot process...",isCapturing:!0}),await new Promise(a=>setTimeout(a,200));let a=X();if(!a)throw Error("Canvas not available for dot process");let e=a.parentElement,m={position:a.style.position,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height,zIndex:a.style.zIndex};document.body.appendChild(a),a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100vw",a.style.height="100vh",a.style.zIndex="10";let n=window.innerWidth,o=window.innerHeight;a.width=n,a.height=o;let p=a.getContext("2d");p.clearRect(0,0,n,o),p.fillStyle="white",p.fillRect(0,0,n,o);let q=k?(0,h.getRandomPosition)(a,20):b;if(!q||"number"!=typeof q.x||"number"!=typeof q.y)throw Error("Invalid dot position");(0,h.drawRedDot)(p,q.x,q.y,12,!1);let r=setInterval(()=>{(0,h.drawRedDot)(p,q.x,q.y,12,!1)},50);document.querySelectorAll(".dot-countdown, .calibrate-countdown").forEach(a=>{a.parentNode&&a.parentNode.removeChild(a)});let s=document.createElement("div");s.className="dot-countdown",s.style.cssText=`
        position: fixed;
        left: ${q.x}px;
        top: ${q.y}px;
        transform: translate(-50%, -50%);
        color: red;
        font-size: 36px;
        font-weight: bold;
        text-shadow: 0 0 10px white, 0 0 20px white;
        z-index: 10000;
        background-color: rgba(255, 255, 255, 0.8);
        border: 2px solid red;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      `,document.body.appendChild(s);for(let a=3;a>0;a--)s.textContent=a,c?.({processStatus:`Countdown: ${a}`,countdownValue:a,isCapturing:!0}),(0,h.drawRedDot)(p,q.x,q.y,12,!1),await new Promise(a=>setTimeout(a,800)),(0,h.drawRedDot)(p,q.x,q.y,12,!1);s.textContent="✓",(0,h.drawRedDot)(p,q.x,q.y,12,!1),setTimeout(()=>{s.parentNode&&s.parentNode.removeChild(s)},300),await new Promise(a=>setTimeout(a,l)),(0,h.drawRedDot)(p,q.x,q.y,12,!1);let t=await (0,i.captureImagesAtPoint)({point:q,captureCount:g,canvasRef:{current:a},setCaptureCount:j,showCapturePreview:h.showCapturePreview});return clearInterval(r),e&&a.parentElement!==e&&e.appendChild(a),a.style.position=m.position||"",a.style.top=m.top||"",a.style.left=m.left||"",a.style.width=m.width||"100%",a.style.height=m.height||"100%",a.style.zIndex=m.zIndex||"",e&&(a.width=e.clientWidth||800,a.height=e.clientHeight||600),p.fillStyle="white",p.fillRect(0,0,a.width,a.height),c?.({processStatus:"Capture completed",isCapturing:!1}),setTimeout(()=>{"function"==typeof d&&d(!0)},2e3),{success:!0,position:q,captureResult:t}}catch(a){return console.error("Error in handleDotProcess:",a),c?.({processStatus:`Error: ${a.message}`,isCapturing:!1}),setTimeout(()=>{"function"==typeof d&&d(!0)},1e3),{success:!1,error:a.message}}},Z=async()=>{if(!J)try{let b=document.querySelector(".control-input-field"),c=document.querySelectorAll(".control-input-field")[1],d=m||1,e=o||3;if(b){let a=parseInt(b.value,10);!isNaN(a)&&a>0&&(d=a,n(d))}if(c){let a=parseInt(c.value,10);!isNaN(a)&&a>0&&(e=a,p(e))}"function"==typeof f&&f("toggleTopBar",!1),K(!0),C(d),s(`Starting ${d} random captures with ${e}s delay...`);let g=0;for(let b=1;b<=d;b++){s(`Capture ${b} of ${d}`),C(d-b+1);let c=await Y({useRandomPosition:!0,onStatusUpdate:a=>{a.processStatus&&s(`Capture ${b}/${d}: ${a.processStatus}`)},toggleTopBar:a=>{a&&b<d||"function"==typeof f&&f("toggleTopBar",a)},triggerCameraAccess:a,setIsCapturing:a=>{(a||!(b<d))&&K(a)},captureCount:H,setCaptureCount:I,postCountdownDelay:800});c&&c.success&&g++,b<d&&(s(`Waiting ${e}s before next capture...`),await new Promise(a=>setTimeout(a,1e3*e)))}s(`Random capture sequence completed: ${g}/${d} captures successful`),C(0)}catch(a){console.error("Random sequence error:",a),s(`Random sequence failed: ${a.message}`)}finally{K(!1),setTimeout(()=>{"function"==typeof f&&f("toggleTopBar",!0)},1e3)}},$=async()=>{if(J)return;let a=null,b=null,d={},e=null,g=null;try{if("function"==typeof f&&f("toggleTopBar",!1),K(!0),E(!0),s("Starting calibration sequence..."),await new Promise(a=>setTimeout(a,300)),!(a=X())){s("Error: Canvas not found"),K(!1),"function"==typeof f&&f("toggleTopBar",!0);return}b=a.parentElement,d={position:a.style.position,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height,zIndex:a.style.zIndex},document.body.appendChild(a),a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100vw",a.style.height="100vh",a.style.zIndex="10";let j=window.innerWidth,k=window.innerHeight;a.width=j,a.height=k,console.log(`Canvas set to fullscreen: ${j}x${k}`);let l=a.getContext("2d");l.clearRect(0,0,j,k),l.fillStyle="white",l.fillRect(0,0,j,k);let{generateCalibrationPoints:m}=await Promise.resolve().then(c.bind(c,4426)),n=m(j,k);if(!n||0===n.length)throw Error("Failed to generate calibration points");(e=document.createElement("div")).className="calibrate-status-indicator",e.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: rgba(0, 102, 204, 0.9);
        color: white;
        font-size: 16px;
        font-weight: bold;
        padding: 10px 15px;
        border-radius: 8px;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      `,e.textContent="Calibration: Initializing...",document.body.appendChild(e);let o=0;for(let b=0;b<n.length;b++){let c=n[b];g&&(clearInterval(g),g=null),e.textContent=`Calibration: Point ${b+1}/${n.length}`,s(`Processing calibration point ${b+1}/${n.length}`),(a.width!==j||a.height!==k)&&(console.warn(`Canvas dimensions changed. Resetting to ${j}x${k}`),a.width=j,a.height=k),a.parentElement!==document.body&&(document.body.appendChild(a),a.style.position="fixed",a.style.top="0",a.style.left="0",a.style.width="100vw",a.style.height="100vh",a.style.zIndex="10"),l.clearRect(0,0,j,k),l.fillStyle="white",l.fillRect(0,0,j,k),(0,h.drawRedDot)(l,c.x,c.y,14,!1);let d=()=>{(a.width!==j||a.height!==k)&&(a.width=j,a.height=k,l.fillStyle="white",l.fillRect(0,0,j,k)),a.parentElement!==document.body&&document.body.appendChild(a),(0,h.drawRedDot)(l,c.x,c.y,14,!1)};g=setInterval(d,50),document.querySelectorAll(".dot-countdown, .calibrate-countdown").forEach(a=>{a.parentNode&&a.parentNode.removeChild(a)});let f=document.createElement("div");f.className="dot-countdown",f.style.cssText=`
          position: fixed;
          left: ${c.x}px;
          top: ${c.y-60}px;
          transform: translateX(-50%);
          color: red;
          font-size: 36px;
          font-weight: bold;
          text-shadow: 0 0 10px white, 0 0 20px white;
          z-index: 10000;
          background-color: rgba(255, 255, 255, 0.8);
          border: 2px solid red;
          border-radius: 50%;
          width: 50px;
          height: 50px;
          display: flex;
          justify-content: center;
          align-items: center;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        `,document.body.appendChild(f);try{for(let a=3;a>0;a--)f.textContent=a,s(`Point ${b+1}/${n.length}: Countdown ${a}`),d(),await new Promise(a=>setTimeout(a,800)),d();f.textContent="✓",d(),setTimeout(()=>{f.parentNode&&f.parentNode.removeChild(f)},300),d(),console.log(`Capturing calibration point ${b+1}/${n.length} at (${c.x}, ${c.y})`),(0,h.drawRedDot)(l,c.x,c.y,14,!1);let e=await (0,i.captureImagesAtPoint)({point:c,captureCount:H,canvasRef:{current:a},setCaptureCount:I,showCapturePreview:h.showCapturePreview});e&&(e.screenImage||e.success)&&o++,await new Promise(a=>setTimeout(a,1200))}catch(a){console.error(`Error processing calibration point ${b+1}:`,a)}finally{f.parentNode&&f.parentNode.removeChild(f),g&&(clearInterval(g),g=null)}}e&&(e.textContent=`Calibration complete: ${o}/${n.length} points`),s(`Calibration completed: ${o}/${n.length} points captured`)}catch(a){console.error("Calibration error:",a),s(`Calibration error: ${a.message}`),g&&clearInterval(g)}finally{if(e&&e.parentNode&&setTimeout(()=>{e.parentNode.removeChild(e)},3e3),a)try{if(b&&a.parentElement!==b)b.appendChild(a);else if(!b){let b=document.querySelector(".canvas-container");b&&a.parentElement!==b&&b.appendChild(a)}a.style.position=d.position||"",a.style.top=d.top||"",a.style.left=d.left||"",a.style.width=d.width||"100%",a.style.height=d.height||"100%",a.style.zIndex=d.zIndex||"";let c=a.parentElement;c?(a.width=c.clientWidth||800,a.height=c.clientHeight||600):(a.width=800,a.height=600);let e=a.getContext("2d");e.clearRect(0,0,a.width,a.height),e.fillStyle="white",e.fillRect(0,0,a.width,a.height),console.log("Canvas restored to original state")}catch(a){console.error("Error restoring canvas:",a)}K(!1),setTimeout(()=>{"function"==typeof f&&f("toggleTopBar",!0)},1e3)}},_=async()=>{J||await Y({useRandomPosition:!0,onStatusUpdate:a=>{a.processStatus&&s(a.processStatus),void 0!==a.isCapturing&&K(a.isCapturing)},toggleTopBar:a=>{"function"==typeof f&&f("toggleTopBar",a)},triggerCameraAccess:a,setIsCapturing:K,captureCount:H,setCaptureCount:I,postCountdownDelay:1e3})};(0,e.useEffect)(()=>{},[H,f]);let aa=()=>{(()=>{let a=X();if(!a)return console.warn("No canvas found for clearing");let b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),b.fillStyle="white",b.fillRect(0,0,a.width,a.height),w(null)})(),s(""),C(0),K(!1),u(null),E(!0)},ab=()=>{let a=!L;M(a),s(`Head pose visualization ${a?"enabled":"disabled"}`),f&&f("headPose")},ac=()=>{let a=!N;O(a),s(`Bounding box ${a?"shown":"hidden"}`),f&&f("boundingBox")},ad=()=>{let a=!P;Q(a),s(`Mask ${a?"shown":"hidden"}`),f&&f("mask")},ae=()=>{let a=!R;S(a),s(`Parameters ${a?"shown":"hidden"}`),f&&f("parameters")},af=()=>{let a=!T;U(a),f?f("preview",a):W(!0)},ag=[{text:"Set Random",abbreviatedText:"SRandom",onClick:Z,disabled:J},{text:"Random Dot",abbreviatedText:"Random",onClick:_,disabled:J},{text:"Set Calibrate",abbreviatedText:"Calibrate",onClick:$,disabled:J},{text:"Clear All",abbreviatedText:"Clear",onClick:aa},{divider:!0},{text:"Draw Head pose",abbreviatedText:"Head pose",onClick:ab,active:L},{text:"Show Bounding Box",abbreviatedText:"☐ Box",onClick:ac,active:N},{text:T?"Stop Camera":"Show Preview",abbreviatedText:T?"Stop":"Preview",onClick:()=>{T||a(!0)?af():W(!0)},active:T,disabled:J},{text:"\uD83D\uDE37 Show Mask",abbreviatedText:"\uD83D\uDE37 Mask",onClick:ad,active:P},{text:"Parameters",abbreviatedText:"Values",onClick:ae,active:R}];return(0,d.jsxs)("div",{children:[b?(0,d.jsx)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:ag.filter(a=>!a.divider).map((a,b)=>(0,d.jsx)(k,{text:a.text,abbreviatedText:a.abbreviatedText,onClick:a.onClick,disabled:a.disabled,active:a.active},b))}):(0,d.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,d.jsx)(k,{text:"Set Random",abbreviatedText:"SRandom",onClick:Z,disabled:J}),(0,d.jsx)(k,{text:"Go back",abbreviatedText:"← Back",onClick:()=>{l.push("/")},customClass:"bg-gray-200 hover:bg-gray-300"}),(0,d.jsx)(k,{text:"Set Calibrate",abbreviatedText:"Calibrate",onClick:$,disabled:J})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsx)(k,{text:"Random Dot",abbreviatedText:"Random",onClick:_,disabled:J}),(0,d.jsx)(k,{text:"Clear All",abbreviatedText:"Clear",onClick:aa})]}),(0,d.jsx)("hr",{className:"my-3 border-gray-200"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsx)(k,{text:"Draw Head pose",abbreviatedText:"Head pose",onClick:ab,active:L}),(0,d.jsx)(k,{text:"Show Bounding Box",abbreviatedText:"☐ Box",onClick:ac,active:N})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsx)(k,{text:T?"Stop Camera":"Show Preview",abbreviatedText:T?"Stop":"Preview",onClick:af,active:T}),(0,d.jsx)(k,{text:"\uD83D\uDE37 Show Mask",abbreviatedText:"\uD83D\uDE37 Mask",onClick:ad,active:P})]}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,d.jsx)(k,{text:"Parameters",abbreviatedText:"Values",onClick:ae,active:R}),(0,d.jsx)("div",{})," "]})]}),(r||B>0||t)&&(0,d.jsxs)("div",{className:"status-display mt-4 p-2 bg-blue-50 rounded-md",children:[r&&(0,d.jsx)("div",{className:"text-sm font-medium text-blue-800",children:r}),B>0&&(0,d.jsxs)("div",{className:"text-sm font-medium text-yellow-600",children:["Remaining: ",B]}),t&&(0,d.jsx)("div",{className:"text-2xl font-bold text-red-600",children:t})]}),D&&(0,d.jsxs)("div",{className:"canvas-container mt-4",style:{position:"relative",width:"100%",height:"40vh",minHeight:"300px",border:"1px solid #e0e0e0",backgroundColor:"white",borderRadius:"4px",overflow:"hidden"},children:[(0,d.jsx)("canvas",{ref:q,className:"tracking-canvas",style:{width:"100%",height:"100%"}}),t&&v&&(0,d.jsx)("div",{className:"dot-countdown",style:{position:"absolute",left:`${v.x-15}px`,top:`${v.y-40}px`,color:"red",fontSize:"28px",fontWeight:"bold"},children:t})]}),V&&(0,d.jsx)("div",{className:"camera-permission-popup",style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:15},children:(0,d.jsxs)("div",{className:"camera-permission-dialog",style:{width:"400px",backgroundColor:"white",borderRadius:"8px",padding:"20px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"},children:[(0,d.jsx)("h3",{className:"camera-permission-title",style:{margin:"0 0 15px",fontSize:"18px",fontWeight:"bold"},children:"Camera Access Required"}),(0,d.jsx)("p",{className:"camera-permission-message",style:{margin:"0 0 20px",fontSize:"14px",lineHeight:"1.4"},children:'This application needs access to your camera to function properly. When prompted by your browser, please click "Allow" to grant camera access.'}),(0,d.jsxs)("div",{className:"camera-permission-buttons",style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[(0,d.jsx)("button",{onClick:()=>{W(!1)},className:"camera-btn",style:{padding:"8px 16px",backgroundColor:"#f0f0f0",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Cancel"}),(0,d.jsx)("button",{onClick:()=>{W(!1),a&&a(!0)},className:"camera-btn",style:{padding:"8px 16px",backgroundColor:"#0066cc",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Continue"})]})]})})]})}),m=g()(()=>Promise.resolve(l),{ssr:!1});function n(){let a=(0,e.useRef)(),[b,c]=(0,e.useState)(!1),[f,g]=(0,e.useState)(!1);return(0,d.jsx)("div",{className:"flex flex-col min-h-screen bg-gray-100",children:(0,d.jsx)("main",{className:"flex-grow p-4",children:(0,d.jsx)(m,{ref:a,triggerCameraAccess:c,isCompactMode:f,onActionClick:b=>{if(a.current)switch(b){case"random":a.current.handleRandomDot();break;case"setRandom":a.current.handleSetRandom();break;case"calibrate":a.current.handleSetCalibrate();break;case"clear":a.current.handleClearAll()}}})})})}},9501:(a,b,c)=>{a.exports=c(9754)},9754:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{default:function(){return i},noSSR:function(){return h}});let d=c(7020),e=c(8732);c(2015);let f=d._(c(2729));function g(a){return{default:(null==a?void 0:a.default)||a}}function h(a,b){delete b.webpack,delete b.modules;let c=b.loading;return()=>(0,e.jsx)(c,{error:null,isLoading:!0,pastDelay:!1,timedOut:!1})}function i(a,b){let c=f.default,d={loading:a=>{let{error:b,isLoading:c,pastDelay:d}=a;return null}};a instanceof Promise?d.loader=()=>a:"function"==typeof a?d.loader=a:"object"==typeof a&&(d={...d,...a});let e=(d={...d,...b}).loader;return(d.loadableGenerated&&(d={...d,...d.loadableGenerated},delete d.loadableGenerated),"boolean"!=typeof d.ssr||d.ssr)?c({...d,loader:()=>null!=e?e().then(g):Promise.resolve(g(()=>null))}):(delete d.webpack,delete d.modules,h(c,d))}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)}};