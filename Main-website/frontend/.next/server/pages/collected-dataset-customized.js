(()=>{var a={};a.id=9836,a.ids=[636,3220,9836],a.modules={37:a=>{"use strict";a.exports=import("uuid")},156:a=>{"use strict";a.exports=require("next/dist/shared/lib/utils")},361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},1322:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/format-url")},1418:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>L,default:()=>H,getServerSideProps:()=>K,getStaticPaths:()=>J,getStaticProps:()=>I,handler:()=>G,reportWebVitals:()=>M,routeModule:()=>S,unstable_getServerProps:()=>Q,unstable_getServerSideProps:()=>R,unstable_getStaticParams:()=>P,unstable_getStaticPaths:()=>O,unstable_getStaticProps:()=>N});var e=c(3885),f=c(237),g=c(772),h=c(2410),i=c(1322),j=c(5124),k=c(8647),l=c(3709),m=c(7909),n=c(5122),o=c(1413),p=c(9616),q=c.n(p),r=c(7522),s=c(2303),t=c(6755),u=c(156),v=c(12),w=c(2072),x=c(8164),y=c(4971),z=c(8737),A=c(6439),B=c(5735),C=c(6713),D=c(3103),E=c(5952),F=a([r,s]);[r,s]=F.then?(await F)():F;let H=(0,o.M)(s,"default"),I=(0,o.M)(s,"getStaticProps"),J=(0,o.M)(s,"getStaticPaths"),K=(0,o.M)(s,"getServerSideProps"),L=(0,o.M)(s,"config"),M=(0,o.M)(s,"reportWebVitals"),N=(0,o.M)(s,"unstable_getStaticProps"),O=(0,o.M)(s,"unstable_getStaticPaths"),P=(0,o.M)(s,"unstable_getStaticParams"),Q=(0,o.M)(s,"unstable_getServerProps"),R=(0,o.M)(s,"unstable_getServerSideProps"),S=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/collected-dataset-customized",pathname:"/collected-dataset-customized",bundlePath:"",filename:""},distDir:".next",projectDir:"",components:{App:r.default,Document:q()},userland:s});async function G(a,b,c){var d,e;let o="/collected-dataset-customized";"/index"===o&&(o="/");let p="false",q=await S.prepare(a,b,{srcPage:o,multiZoneDraftMode:p});if(!q){b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve());return}let{buildId:r,query:F,params:G,parsedUrl:H,originalQuery:M,originalPathname:N,buildManifest:O,nextFontManifest:P,serverFilesManifest:Q,reactLoadableManifest:R,prerenderManifest:T,isDraftMode:U,isOnDemandRevalidate:V,revalidateOnlyGenerated:W,locale:X,locales:Y,defaultLocale:Z,routerServerContext:$,nextConfig:_,resolvedPathname:aa}=q,ab=null==Q||null==(e=Q.config)||null==(d=e.experimental)?void 0:d.isExperimentalCompile,ac=!!K,ad=!!I,ae=!!J,af=!!(s.default||s).getInitialProps,ag=F.amp&&L.amp,ah=null,ai=!1,aj=q.isNextDataRequest&&(ad||ac),ak="/404"===o,al="/500"===o,am="/_error"===o;if(S.isDev||U||!ad||(ah=`${X?`/${X}`:""}${("/"===o||"/"===aa)&&X?"":aa}${ag?".amp":""}`,(ak||al||am)&&(ah=`${X?`/${X}`:""}${o}${ag?".amp":""}`),ah="/index"===ah?"/":ah),ae&&!U){let a=(0,E.removeTrailingSlash)(X?(0,D.addPathPrefix)(aa,`/${X}`):aa),b=!!T.routes[a]||T.notFoundRoutes.includes(a),c=T.dynamicRoutes[o];if(c){if(!1===c.fallback&&!b)throw new A.NoFallbackError;"string"!=typeof c.fallback||b||aj||(ai=!0)}}(ai&&(0,C.isBot)(a.headers["user-agent"]||"")||(0,j.getRequestMeta)(a,"minimalMode"))&&(ai=!1);let an=(0,h.getTracer)(),ao=an.getActiveScopeSpan();try{let d=a.method||"GET",e=(0,i.formatUrl)({pathname:_.trailingSlash?H.pathname:(0,E.removeTrailingSlash)(H.pathname||"/"),query:ad?{}:M}),q=(null==$?void 0:$.publicRuntimeConfig)||_.publicRuntimeConfig,A=async h=>{var A,C;let D,E=async({previousCacheEntry:t})=>{var u;let v=async()=>{try{var c,f,u;return await S.render(a,b,{query:ad&&!ab?{...G,...ag?{amp:F.amp}:{}}:{...F,...G},params:G,page:o,renderContext:{isDraftMode:U,isFallback:ai,developmentNotFoundSourcePage:(0,j.getRequestMeta)(a,"developmentNotFoundSourcePage")},sharedContext:{buildId:r,customServer:!!(null==$?void 0:$.isCustomServer)||void 0,deploymentId:!1},renderOpts:{params:G,routeModule:S,page:o,pageConfig:L||{},Component:(0,k.T)(s),ComponentMod:s,getStaticProps:I,getStaticPaths:J,getServerSideProps:K,supportsDynamicResponse:!ad,buildManifest:O,nextFontManifest:P,reactLoadableManifest:R,assetPrefix:_.assetPrefix,strictNextHead:_.experimental.strictNextHead??!0,previewProps:T.preview,images:_.images,nextConfigOutput:_.output,optimizeCss:!!_.experimental.optimizeCss,nextScriptWorkers:!!_.experimental.nextScriptWorkers,domainLocales:null==(c=_.i18n)?void 0:c.domains,crossOrigin:_.crossOrigin,multiZoneDraftMode:p,basePath:_.basePath,canonicalBase:_.amp.canonicalBase||"",ampOptimizerConfig:null==(f=_.experimental.amp)?void 0:f.optimizer,disableOptimizedLoading:_.experimental.disableOptimizedLoading,largePageDataBytes:_.experimental.largePageDataBytes,runtimeConfig:Object.keys(q).length>0?q:void 0,isExperimentalCompile:ab,experimental:{clientTraceMetadata:_.experimental.clientTraceMetadata||[]},locale:X,locales:Y,defaultLocale:Z,setIsrStatus:null==$?void 0:$.setIsrStatus,isNextDataRequest:aj&&(ac||ad),resolvedUrl:e,resolvedAsPath:ac||af?(0,i.formatUrl)({pathname:aj?(0,m.normalizeDataPath)(N):N,query:M}):e,isOnDemandRevalidate:V,ErrorDebug:(0,j.getRequestMeta)(a,"PagesErrorDebug"),err:(0,j.getRequestMeta)(a,"invokeError"),dev:S.isDev,distDir:`${S.projectDir}/${S.distDir}`,ampSkipValidation:null==(u=_.experimental.amp)?void 0:u.skipValidation,ampValidator:(0,j.getRequestMeta)(a,"ampValidator")}}).then(a=>{let{metadata:b}=a,c=b.cacheControl;return"isNotFound"in b&&b.isNotFound?{value:null,cacheControl:c}:b.isRedirect?{value:{kind:n.CachedRouteKind.REDIRECT,props:b.pageData??b.flightData},cacheControl:c}:{value:{kind:n.CachedRouteKind.PAGES,html:a,pageData:a.metadata.pageData,headers:a.metadata.headers,status:a.metadata.statusCode},cacheControl:c}}).finally(()=>{if(!h)return;h.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let c=an.getRootSpanAttributes();if(!c)return;if(c.get("next.span_type")!==g.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${c.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=c.get("next.route");if(e){let a=`${d} ${e}`;h.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),h.updateName(a)}else h.updateName(`${d} ${a.url}`)})}catch(b){throw(null==t?void 0:t.isStale)&&await S.onRequestError(a,b,{routerKind:"Pages Router",routePath:o,routeType:"render",revalidateReason:(0,l.c)({isRevalidate:ad,isOnDemandRevalidate:V})},$),b}};if(t&&(ai=!1),ai){let b=await S.getResponseCache(a).get(S.isDev?null:X?`/${X}${o}`:o,async({previousCacheEntry:a=null})=>S.isDev?v():(0,z.toResponseCacheEntry)(a),{routeKind:f.RouteKind.PAGES,isFallback:!0,isRoutePPREnabled:!1,isOnDemandRevalidate:!1,incrementalCache:await S.getIncrementalCache(a,_,T),waitUntil:c.waitUntil});if(b)return delete b.cacheControl,b.isMiss=!0,b}return!(0,j.getRequestMeta)(a,"minimalMode")&&V&&W&&!t?(b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null):ai&&(null==t||null==(u=t.value)?void 0:u.kind)===n.CachedRouteKind.PAGES?{value:{kind:n.CachedRouteKind.PAGES,html:new y.default(Buffer.from(t.value.html),{contentType:"text/html;utf-8",metadata:{statusCode:t.value.status,headers:t.value.headers}}),pageData:{},status:t.value.status,headers:t.value.headers},cacheControl:{revalidate:0,expire:void 0}}:v()},Q=await S.handleResponse({cacheKey:ah,req:a,nextConfig:_,routeKind:f.RouteKind.PAGES,isOnDemandRevalidate:V,revalidateOnlyGenerated:W,waitUntil:c.waitUntil,responseGenerator:E,prerenderManifest:T});if(!ai||(null==Q?void 0:Q.isMiss)||(ai=!1),Q){if(ad&&!(0,j.getRequestMeta)(a,"minimalMode")&&b.setHeader("x-nextjs-cache",V?"REVALIDATED":Q.isMiss?"MISS":Q.isStale?"STALE":"HIT"),!ad||ai)b.getHeader("Cache-Control")||(D={revalidate:0,expire:void 0});else if(ak){let b=(0,j.getRequestMeta)(a,"notFoundRevalidate");D={revalidate:void 0===b?0:b,expire:void 0}}else if(al)D={revalidate:0,expire:void 0};else if(Q.cacheControl)if("number"==typeof Q.cacheControl.revalidate){if(Q.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${Q.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});D={revalidate:Q.cacheControl.revalidate,expire:(null==(A=Q.cacheControl)?void 0:A.expire)??_.expireTime}}else D={revalidate:w.CACHE_ONE_YEAR,expire:void 0};if(D&&!b.getHeader("Cache-Control")&&b.setHeader("Cache-Control",(0,t.getCacheControlHeader)(D)),!Q.value)return((0,j.addRequestMeta)(a,"notFoundRevalidate",null==(C=Q.cacheControl)?void 0:C.revalidate),b.statusCode=404,aj)?void b.end('{"notFound":true}'):void((null==$?void 0:$.render404)?await $.render404(a,b,H,!1):b.end("This page could not be found"));if(Q.value.kind===n.CachedRouteKind.REDIRECT)if(!aj)return await (a=>{let c={destination:a.pageProps.__N_REDIRECT,statusCode:a.pageProps.__N_REDIRECT_STATUS,basePath:a.pageProps.__N_REDIRECT_BASE_PATH},d=(0,v.getRedirectStatus)(c),{basePath:e}=_;e&&!1!==c.basePath&&c.destination.startsWith("/")&&(c.destination=`${e}${c.destination}`),c.destination.startsWith("/")&&(c.destination=(0,u.normalizeRepeatedSlashes)(c.destination)),b.statusCode=d,b.setHeader("Location",c.destination),d===B.RedirectStatusCode.PermanentRedirect&&b.setHeader("Refresh",`0;url=${c.destination}`),b.end(c.destination)})(Q.value.props),null;else{b.setHeader("content-type","application/json"),b.end(JSON.stringify(Q.value.props));return}if(Q.value.kind!==n.CachedRouteKind.PAGES)throw Object.defineProperty(Error("Invariant: received non-pages cache entry in pages handler"),"__NEXT_ERROR_CODE",{value:"E695",enumerable:!1,configurable:!0});if(S.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),U&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),(0,j.getRequestMeta)(a,"customErrorRender")||am&&(0,j.getRequestMeta)(a,"minimalMode")&&500===b.statusCode)return null;await (0,x.sendRenderResult)({req:a,res:b,result:!aj||am||al?Q.value.html:new y.default(Buffer.from(JSON.stringify(Q.value.pageData)),{contentType:"application/json",metadata:Q.value.html.metadata}),generateEtags:_.generateEtags,poweredByHeader:_.poweredByHeader,cacheControl:S.isDev?void 0:D,type:aj?"json":"html"})}};ao?await A():await an.withPropagatedContext(a.headers,()=>an.trace(g.BaseServerSpan.handleRequest,{spanName:`${d} ${a.url}`,kind:h.SpanKind.SERVER,attributes:{"http.method":d,"http.target":a.url}},A))}catch(b){throw b instanceof A.NoFallbackError||await S.onRequestError(a,b,{routerKind:"Pages Router",routePath:o,routeType:"render",revalidateReason:(0,l.c)({isRevalidate:ad,isOnDemandRevalidate:V})},$),b}}d()}catch(a){d(a)}})},2015:a=>{"use strict";a.exports=require("react")},2303:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{ActionButton:()=>v,MainComponent:()=>x,default:()=>t});var e=c(8732),f=c(7085),g=c.n(f),h=c(2015),i=c(9788),j=c.n(i),k=c(9501),l=c.n(k),m=c(7438),n=c(7393),o=c(3453);c(6352);var p=c(3905),q=c(4233),r=c(5976),s=a([m,p]);[m,p]=s.then?(await s)():s,l()(()=>Promise.all([c.e(3203),c.e(5581)]).then(c.bind(c,5581)),{loadableGenerated:{modules:["pages/collected-dataset-customized/index.js -> ./components-gui/cameraAccess"]},ssr:!1,loading:()=>(0,e.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"480px",height:"360px",backgroundColor:"#f0f8ff",border:"2px solid #0066cc",borderRadius:"8px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",textAlign:"center",zIndex:999},children:[(0,e.jsx)("div",{style:{fontSize:"48px",marginBottom:"15px"},children:"\uD83D\uDCF7"}),(0,e.jsx)("p",{style:{fontSize:"16px",fontWeight:"bold",color:"#0066cc"},children:"Loading camera..."})]})});let u=(a,b)=>{if(a===b)return!0;if("object"!=typeof a||"object"!=typeof b||null===a||null===b)return!1;let c=Object.keys(a),d=Object.keys(b);return c.length===d.length&&c.every(c=>d.includes(c)&&u(a[c],b[c]))},v=({text:a,abbreviatedText:b,onClick:c,customClass:d="",disabled:f=!1,active:g=!1})=>{let[i,j]=(0,h.useState)(!1),{settings:k}=(0,r.useAdminSettings)(),[l,m]=(0,h.useState)("default"),[n,o]=(0,h.useState)(!1),[p,q]=(0,h.useState)(1),[s,t]=(0,h.useState)(""),u=(0,h.useMemo)(()=>({className:`action-button ${d} ${i?"abbreviated":""} ${g?"active":""}`,onClick:c,disabled:f,title:a}),[d,i,g,c,f,a]);return(0,h.useEffect)(()=>{},[]),(0,h.useEffect)(()=>{let a=a=>{if(a.detail&&"userIdChange"===a.detail.type){let b=a.detail.userId;b!==l&&m(b)}};return window.addEventListener("userIdChange",a),()=>{window.removeEventListener("userIdChange",a)}},[l]),(0,e.jsxs)("button",{...u,children:[i?b:a,s&&(0,e.jsx)("div",{className:"process-status",children:s})]})};class w{constructor(){this.canvas=null,this.originalState=null,this.resizeObserver=null,this.isFullscreen=!1,this.isInitialized=!1}getCanvas(){if(this.canvas&&this.canvas.parentNode)return this.canvas;let a=document.querySelector("#tracking-canvas");return a?console.log("Found existing main canvas"):((a=document.createElement("canvas")).className="tracking-canvas",a.id="tracking-canvas",console.log("Created new main canvas")),this.canvas=a,a}initializeCanvas(a=null){if(this.isInitialized)return console.log("Canvas already initialized"),this.getCanvas();let b=this.getCanvas();if(!b)return null;let c=a||document.querySelector(".canvas-container")||document.querySelector(".main-content")||document.body;this.updateCanvasSize(b,c);let d=b.getContext("2d");d.fillStyle="yellow",d.fillRect(0,0,b.width,b.height),b.parentNode||c.appendChild(b);let e=document.querySelector("#canvas-placeholder");return e&&e.parentNode&&e.parentNode.removeChild(e),window.whiteScreenCanvas=b,window.globalCanvasManager=this,this.setupResponsiveCanvas(b,c),this.isInitialized=!0,console.log(`Main canvas initialized: ${b.width}x${b.height}`),b}updateCanvasSize(a,b){if(!a||!b)return;let c=window.innerWidth||800,d=window.innerHeight||600,e=b.getBoundingClientRect(),f=e.width||b.clientWidth||c,g=e.height||b.clientHeight||d;a.width=f,a.height=g,a.style.width="100%",a.style.height="100%",a.style.display="block",a.style.backgroundColor="yellow",this.linkWithOtherCanvases(a)}linkWithOtherCanvases(a){document.querySelectorAll("canvas").forEach(b=>{if(b!==a&&"tracking-canvas"!==b.id){b.width=a.width,b.height=a.height,b.style.width="100%",b.style.height="100%";let c=b.getContext("2d");c.fillStyle="yellow",c.fillRect(0,0,b.width,b.height)}})}setupResponsiveCanvas(a,b){if(!a||!b)return;this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(c=>{for(let d of c)if(d.target===b){this.updateCanvasSize(a,b);let c=a.getContext("2d");c.fillStyle="yellow",c.fillRect(0,0,a.width,a.height)}}),this.resizeObserver.observe(b);let c=()=>{this.updateCanvasSize(a,b);let c=a.getContext("2d");c.fillStyle="yellow",c.fillRect(0,0,a.width,a.height)};window.addEventListener("resize",c),a._windowResizeHandler=c}enterFullscreen(){let a=this.getCanvas();if(!a)return null;this.originalState={parent:a.parentElement,position:a.style.position,top:a.style.top,left:a.style.left,width:a.style.width,height:a.style.height,zIndex:a.style.zIndex},a.parentNode&&a.parentNode.removeChild(a),document.body.appendChild(a),a.style.cssText=`
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 10;
      background-color: yellow !important;
      border: none !important;
      display: block !important;
      opacity: 1 !important;
      pointer-events: auto !important;
      margin: 0 !important;
      padding: 0 !important;
      box-sizing: border-box !important;
      transform: none !important;
    `,a.width=window.innerWidth,a.height=window.innerHeight;let b=a.getContext("2d");return b.fillStyle="yellow",b.fillRect(0,0,a.width,a.height),this.hideUIElements(),this.isFullscreen=!0,console.log("Main canvas entered fullscreen mode"),a}exitFullscreen(){let a=this.getCanvas();if(!a||!this.originalState)return null;this.showUIElements();let b=document.querySelector(".canvas-container")||document.querySelector(".main-content")||document.body;b.appendChild(a),a.style.position="relative",a.style.top="",a.style.left="",a.style.width="100%",a.style.height="100%",a.style.zIndex="",a.style.backgroundColor="yellow",this.updateCanvasSize(a,b);let c=a.getContext("2d");return c.fillStyle="yellow",c.fillRect(0,0,a.width,a.height),this.originalState=null,this.isFullscreen=!1,console.log("Main canvas exited fullscreen mode"),a}hideUIElements(){[".topbar",".canvas-container",".main-content",".metrics-panel",".display-metrics","nav","header",".button-groups",".control-buttons"].forEach(a=>{document.querySelectorAll(a).forEach(a=>{a.style.display="none",a.setAttribute("data-hidden-by-canvas","true")})})}showUIElements(){document.querySelectorAll('[data-hidden-by-canvas="true"]').forEach(a=>{a.style.display="",a.removeAttribute("data-hidden-by-canvas")})}clear(){let a=this.getCanvas();if(!a)return;let b=a.getContext("2d");b.clearRect(0,0,a.width,a.height),b.fillStyle="yellow",b.fillRect(0,0,a.width,a.height),console.log("Canvas cleared with yellow background")}drawDot(a,b,c=12){let d=this.getCanvas();if(!d)return!1;let e=d.getContext("2d");return(0,o.Pt)(e,a,b,c,!1),!0}getDimensions(){let a=this.getCanvas();return a?{width:a.width,height:a.height}:{width:0,height:0}}isInFullscreen(){return this.isFullscreen}destroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.canvas&&this.canvas._windowResizeHandler&&window.removeEventListener("resize",this.canvas._windowResizeHandler),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=null,this.originalState=null,this.isFullscreen=!1,this.isInitialized=!1}}let x=(0,h.forwardRef)(({triggerCameraAccess:a,isCompactMode:b,onActionClick:d},f)=>{let i=(0,q.useRouter)(),{userId:k}=(0,p.S)(),{settings:l,updateSettings:o}=(0,r.useAdminSettings)(f),[s,t]=(0,h.useState)(null),[v,x]=(0,h.useState)(!0),[y,z]=(0,h.useState)(null),[A,B]=(0,h.useState)(!1),[C,D]=(0,h.useState)("checking"),[E,F]=(0,h.useState)(!0),[G,H]=(0,h.useState)(!1),[I,J]=(0,h.useState)(""),[K,L]=(0,h.useState)(""),[M,N]=(0,h.useState)(""),[O,P]=(0,h.useState)(!0),[Q,R]=(0,h.useState)(!1),[S,T]=(0,h.useState)(!1),[U,V]=(0,h.useState)(!1),[W,X]=(0,h.useState)(!1),[Y,Z]=(0,h.useState)(!1),[$,_]=(0,h.useState)(!1),[aa,ab]=(0,h.useState)(!1),[ac,ad]=(0,h.useState)(!1),[ae,af]=(0,h.useState)({width:0,height:0,percentage:100}),[ag,ah]=(0,h.useState)({width:"---",height:"---",distance:"---"}),[ai,aj]=(0,h.useState)(1),[ak,al]=(0,h.useState)(""),[am,an]=(0,h.useState)("default"),[ao,ap]=(0,h.useState)(!1),[aq,ar]=(0,h.useState)(!0),[as,at]=(0,h.useState)(1),[au,av]=(0,h.useState)(1),[aw,ax]=(0,h.useState)(3),[ay,az]=(0,h.useState)(""),[aA,aB]=(0,h.useState)(null),[aC,aD]=(0,h.useState)(null),[aE,aF]=(0,h.useState)([]),[aG,aH]=(0,h.useState)(0),[aI,aJ]=(0,h.useState)(!0),[aK,aL]=(0,h.useState)(null),[aM,aN]=(0,h.useState)(!1),[aO,aP]=(0,h.useState)(!1),aQ=(0,h.useRef)(null);(0,h.useRef)(null),(0,h.useRef)(null),(0,h.useRef)(null);let aR=(0,h.useRef)(new Map),aS=(0,h.useRef)(new Map),aT=(0,h.useCallback)(async a=>{if(!a)return null;try{console.log(`[fetchSettingsFromMongoDB] Fetching settings for user: ${a}`);let b=await fetch(`/api/data-center/settings/${a}`,{headers:{Accept:"application/json","Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY||"A1B2C3D4-E5F6-7890-GHIJ-KLMNOPQRSTUV"}});if(!b.ok)throw Error(`Failed to fetch settings: ${b.status}`);let c=(await b.json()).data||{};console.log(`[fetchSettingsFromMongoDB] Retrieved settings for user ${a}:`,c);let d=Number(c.times_set_random)||1,e=Number(c.delay_set_random)||3;return av(d),ax(e),aR.current.set(a,c),aS.current.set(a,Date.now()),l&&"function"==typeof o&&await o(c,a),c}catch(b){return console.error(`[fetchSettingsFromMongoDB] Error fetching settings for user ${a}:`,b),null}},[l,o]),aU=(0,h.useCallback)(async(a,b)=>{if(!a)return!1;try{console.log(`[saveSettingsToMongoDB] Saving settings for user: ${a}`,b);let c=await fetch(`/api/data-center/settings/${a}`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY||"A1B2C3D4-E5F6-7890-GHIJ-KLMNOPQRSTUV"},body:JSON.stringify(b)});if(!c.ok)throw Error(`Failed to save settings: ${c.status}`);let d=await c.json();return console.log(`[saveSettingsToMongoDB] Settings saved successfully for user ${a}:`,d),aR.current.set(a,b),aS.current.set(a,Date.now()),!0}catch(b){return console.error(`[saveSettingsToMongoDB] Error saving settings for user ${a}:`,b),!1}},[]),aV=(0,h.useCallback)(async()=>{if(!am)return void console.log("[Debug] No current user ID available");console.log(`[Debug] Testing MongoDB integration for user: ${am}`),console.log(`[Debug] Current local state - randomTimes: ${au}, delaySeconds: ${aw}`);let a=await aT(am);console.log("[Debug] Fetched settings from MongoDB:",a);let b=await aU(am,{times_set_random:au+1,delay_set_random:aw+1});console.log("[Debug] Save test result:",b);let c=await aT(am);console.log("[Debug] Verification fetch:",c)},[am,au,aw,aT,aU]),aW=(0,h.useMemo)(()=>new w,[]),aX=(0,h.useMemo)(()=>({getCanvas:()=>aW.getCanvas(),enterFullscreen:()=>aW.enterFullscreen(),exitFullscreen:()=>aW.exitFullscreen(),clear:()=>{aW.clear()},drawDot:(a,b,c=12)=>aW.drawDot(a,b,c),getDimensions:()=>aW.getDimensions(),isFullscreen:()=>aW.isInFullscreen(),resizeToContainer:a=>{let b=aW.getCanvas();if(!b||!a)return!1;let c=window.innerWidth||800,d=window.innerHeight||600,e=a.getBoundingClientRect();b.width=e.width||a.clientWidth||c,b.height=e.height||a.clientHeight||d;let f=b.getContext("2d");return f.fillStyle="yellow",f.fillRect(0,0,b.width,b.height),aW.linkWithOtherCanvases(b),!0},linkWithOtherCanvases:a=>{aW.linkWithOtherCanvases(a)}}),[aW]);(0,h.useEffect)(()=>()=>{},[aX,aW]),(0,h.useEffect)(()=>(B(!0),am&&"default"!==am&&(console.log(`[Initial Mount] Fetching settings for user: ${am}`),aT(am)),()=>{}),[am,aT]),(0,h.useEffect)(()=>{let a=()=>{document.hidden?(ar(!1),c()):ar(!0)},b=()=>{ar(!1),c()},c=()=>{};return document.addEventListener("visibilitychange",a),window.addEventListener("beforeunload",b),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("beforeunload",b),c()}},[]),(0,h.useEffect)(()=>{let a=()=>{ar(!1)};return i.events.on("routeChangeStart",a),()=>{i.events.off("routeChangeStart",a)}},[i]),(0,h.useEffect)(()=>{(async()=>{if(i.isReady)try{if(i.query.userData){let a=JSON.parse(i.query.userData);t(a);return}if(i.query.userId){let a=await fetch(`/api/user-preferences/${i.query.userId}`,{headers:{Accept:"application/json","Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY||"A1B2C3D4-E5F6-7890-GHIJ-KLMNOPQRSTUV"}});if(!a.ok)throw Error("Failed to fetch user data");let b=await a.json();t(b)}}catch(a){console.error("Error loading user data:",a),z(a.message)}finally{x(!1)}})()},[i.isReady,i.query]),(0,h.useEffect)(()=>{let a=async()=>{try{let a=await fetch("/api/check-backend-connection"),b=await a.json();D(b.connected?"connected":"disconnected")}catch(a){console.error("Error checking backend connection:",a),D("disconnected")}};A&&a()},[A]),(0,h.useEffect)(()=>{let a=()=>{if(aQ.current){let a=aQ.current.offsetWidth,b=aQ.current.offsetHeight,c=window.innerWidth/window.screen.width*100;if(ah(c=>({...c,width:a,height:b})),af({width:window.innerWidth,height:window.innerHeight,percentage:Math.round(c)}),aW&&aq){let a=aW.getCanvas();a&&aW.updateCanvasSize(a,aQ.current)}}};if(A)return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[A,aW,aq]),(0,h.useEffect)(()=>{if(!aq)return;let a=aW.initializeCanvas();if(console.log("Global canvas initialized:",a?"success":"failed"),a){let b=a.getContext("2d");b.fillStyle="yellow",b.fillRect(0,0,a.width,a.height),setTimeout(()=>{aW.linkWithOtherCanvases(a)},100)}return()=>{console.log("MainComponent cleanup - canvas removed")}},[aW,aq]),(0,h.useEffect)(()=>{if(l&&am&&l[am]){let a=l[am],b=aR.current.get(am);if(!u(b,a)){let b=Number(a.times_set_random)||1,c=Number(a.delay_set_random)||3;console.log(`[Settings Update] User ${am}: times_set_random=${b}, delay_set_random=${c}`),av(b),ax(c),aR.current.set(am,a),aS.current.set(am,Date.now());let d=new CustomEvent("settingsLoaded",{detail:{userId:am,times_set_random:b,delay_set_random:c,settings:a}});window.dispatchEvent(d)}}},[l,am]),(0,h.useEffect)(()=>{let a=a=>{if(a.detail&&"userIdChange"===a.detail.type){let b=a.detail.userId;if(console.log(`[User ID Change] Switching to user: ${b}`),an(b),aT(b),l&&l[b]){let a=l[b],c=Number(a.times_set_random)||1,d=Number(a.delay_set_random)||3;console.log(`[User ID Change] User ${b}: times_set_random=${c}, delay_set_random=${d}`),av(c),ax(d);let e=new CustomEvent("userSettingsLoaded",{detail:{userId:b,times_set_random:c,delay_set_random:d,settings:a}});window.dispatchEvent(e)}else console.log(`[User ID Change] No cached settings found for user: ${b}, fetching from MongoDB`)}};return window.addEventListener("userIdChange",a),()=>{window.removeEventListener("userIdChange",a)}},[l,aT]),(0,h.useEffect)(()=>{let a=a=>{if(a.detail&&"captureSettings"===a.detail.type){let{userId:b,times_set_random:c,delay_set_random:d}=a.detail;if(b===am){if(console.log(`[Settings Update Event] User ${b}: times_set_random=${c}, delay_set_random=${d}`),void 0!==c){let a=Number(c)||1;av(a),console.log(`[Settings Update] Updated times_set_random to: ${a}`)}if(void 0!==d){let a=Number(d)||3;ax(a),console.log(`[Settings Update] Updated delay_set_random to: ${a}`)}if(l&&l[am]){let a={...l[am],times_set_random:void 0!==c?Number(c):l[am].times_set_random,delay_set_random:void 0!==d?Number(d):l[am].delay_set_random};aR.current.set(am,a)}}}};return window.addEventListener("captureSettingsUpdate",a),()=>{window.removeEventListener("captureSettingsUpdate",a)}},[am,l]),(0,h.useEffect)(()=>{let a=a=>{if(a.detail&&a.detail.userId===am){let{times_set_random:b,delay_set_random:c}=a.detail;console.log(`[TopBar Settings Loaded] User ${am}: times_set_random=${b}, delay_set_random=${c}`),void 0!==b&&av(Number(b)||1),void 0!==c&&ax(Number(c)||3)}};return window.addEventListener("topBarSettingsLoaded",a),()=>{window.removeEventListener("topBarSettingsLoaded",a)}},[am]),(0,h.useEffect)(()=>()=>{},[aW,aX,aT,aU,aV,au,aw,am]),(0,h.useEffect)(()=>()=>{},[]);let aY=async()=>{if(!aO)try{let{default:b}=await c.e(6062).then(c.bind(c,6062)),e=aW.getCanvas();if(!e)throw Error("Canvas not available");let f=new b({canvasRef:{current:e},toggleTopBar:a=>{F(a),"function"==typeof d&&d("toggleTopBar",a)},setIsCapturing:a=>{aP(a),console.log("RandomDotAction: isCapturing set to",a)},setProcessStatus:a=>{az(a),console.log("RandomDotAction: processStatus set to",a)},setCurrentDot:a=>{aD(a),console.log("RandomDotAction: currentDot set to",a)},triggerCameraAccess:a,onStatusUpdate:a=>{a.processStatus&&az(a.processStatus),void 0!==a.isCapturing&&aP(a.isCapturing)},saveImageToServer:!0,setCaptureCounter:aj,captureCounter:ai});await f.handleRandomDot()}catch(a){console.error("Random dot error:",a),az(`Error: ${a.message}`),aP(!1)}},aZ=async()=>{if(!aO)try{let{default:b}=await Promise.all([c.e(3203),c.e(5639)]).then(c.bind(c,5639)),e=aW.getCanvas();if(!e)throw Error("Canvas not available");let f=new b({canvasRef:{current:e},onStatusUpdate:a=>{a.processStatus&&az(a.processStatus),void 0!==a.isCapturing&&aP(a.isCapturing),void 0!==a.remainingCaptures&&aH(a.remainingCaptures)},setCaptureCounter:aj,toggleTopBar:a=>{F(a),"function"==typeof d&&d("toggleTopBar",a)},captureCounter:ai,triggerCameraAccess:a,setIsCapturing:a=>{aP(a),console.log("SetRandomAction: isCapturing set to",a)},setProcessStatus:a=>{az(a),console.log("SetRandomAction: processStatus set to",a)}});await f.handleAction()}catch(a){console.error("Random sequence error:",a),az(`Random sequence failed: ${a.message}`),aP(!1)}},a$=async()=>{if(!aO)try{let b=aW.getCanvas();if(!b)throw Error("Canvas not available");let{default:e}=await Promise.all([c.e(3203),c.e(3485)]).then(c.bind(c,3485)),f=new e({canvasRef:{current:b},toggleTopBar:a=>{F(a),"function"==typeof d&&d("toggleTopBar",a)},setIsCapturing:a=>{aP(a),console.log("SetCalibrateAction: isCapturing set to",a)},setProcessStatus:a=>{az(a),console.log("SetCalibrateAction: processStatus set to",a)},setCurrentDot:a=>{aD(a),console.log("SetCalibrateAction: currentDot set to",a)},triggerCameraAccess:a,onStatusUpdate:a=>{a.processStatus&&az(a.processStatus),void 0!==a.isCapturing&&aP(a.isCapturing)},saveImageToServer:!0,setCaptureCounter:aj,captureCounter:ai});await f.handleSetCalibrate()}catch(a){console.error("Calibration error:",a),az(`Calibration error: ${a.message}`),aP(!1)}},a_=()=>{aW.clear(),az(""),aH(0),aP(!1),aB(null),aJ(!0),aD(null),console.log("Clear All: Reset all states")},a0=(0,h.useCallback)(()=>{let a=!Y;Z(a),az(`Head pose visualization ${a?"enabled":"disabled"}`),d&&d("headPose")},[Y,d]),a1=(0,h.useCallback)(()=>{let a=!$;_(a),az(`Bounding box ${a?"shown":"hidden"}`),d&&d("boundingBox")},[$,d]),a2=(0,h.useCallback)(()=>{let a=!aa;ab(a),az(`Mask ${a?"shown":"hidden"}`),d&&d("mask")},[aa,d]),a3=(0,h.useCallback)(()=>{let a=!ac;ad(a),az(`Parameters ${a?"shown":"hidden"}`),d&&d("parameters")},[ac,d]),a4=(0,h.useCallback)(()=>{let a=!aM;console.log(`[Camera Toggle] Switching camera from ${aM} to ${a}`),aN(a),V(a),a?(az("Starting camera preview..."),setTimeout(()=>{az("Camera preview active")},500)):az("Camera preview stopped"),d?d("preview",a):R(!0)},[aM,U,d,Y,$,aa,ac]),a5=(0,h.useCallback)((a,...b)=>{switch(a){case"preview":let c=void 0!==b[0]?b[0]:!U;console.log(`[Action Handler] Preview action: shouldShow=${c}, current showCamera=${U}`),V(c),aN(c),az(c?"Camera preview started":"Camera preview stopped");break;case"headPose":a0();break;case"boundingBox":a1();break;case"mask":a2();break;case"parameters":a3();break;case"metrics":console.log("Metrics toggle clicked, current state:",O),P(!O),az(`Metrics ${!O?"shown":"hidden"}`);break;case"randomDot":console.log("Random Dot button clicked"),aY();break;case"setRandom":console.log("Set Random button clicked"),aZ();break;case"calibrate":console.log("Set Calibrate button clicked"),a$();break;case"clearAll":console.log("Clear All button clicked"),a_();break;case"toggleTopBar":let d=void 0!==b[0]?b[0]:!E;F(d);break;default:console.log("Unknown action type:",a)}},[U,O,E,a0,a1,a2,a3,aY,aZ,a$,a_]);return(0,h.useCallback)(()=>{V(!1),aN(!1),az("Camera preview stopped")},[]),(0,h.useCallback)(a=>{ah({width:a.width,height:a.height,distance:a.distance||"---"}),N(`Camera ready: ${a.width}x${a.height}`),az("Camera preview active")},[]),(0,h.useImperativeHandle)(f,()=>({handleRandomDot:aY,handleSetRandom:aZ,handleSetCalibrate:a$,handleClearAll:a_,handleToggleHeadPose:a0,handleToggleBoundingBox:a1,handleToggleMask:a2,handleToggleParameters:a3,handleToggleCamera:a4})),(0,e.jsxs)("div",{className:`main-container collected-dataset-customized-page ${(()=>{let{percentage:a}=ae;return a<35?"window-size-tiny":a<50?"window-size-small":a<70?"window-size-medium":"window-size-large"})()}`,style:{height:"100vh",width:"100vw",overflow:"hidden",position:"fixed",top:0,left:0,margin:0,padding:0},children:[(0,e.jsxs)(j(),{children:[(0,e.jsx)("title",{className:"jsx-2b2456cd71359df6",children:"Camera Dataset Collection"}),(0,e.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1",className:"jsx-2b2456cd71359df6"}),(0,e.jsx)(g(),{id:"2b2456cd71359df6",children:".collected-dataset-customized-page.jsx-2b2456cd71359df6{height:100vh;width:100vw;overflow:hidden;position:fixed;top:0;left:0;margin:0;padding:0;z-index:4}"})]}),A&&"disconnected"===C&&(0,e.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",padding:"6px 0",backgroundColor:"#ffe0b2",color:"#e65100",textAlign:"center",fontSize:"14px",fontWeight:"bold",zIndex:110},children:"⚠️ Backend disconnected. Hurry up, Make ONLINE please and Using mock mode"}),A&&G&&(0,e.jsx)("div",{className:"warning-banner",style:{position:"fixed",top:E?"disconnected"===C?"32px":"60px":"0",left:"0",width:"100%",backgroundColor:"#ffeb3b",color:"#333",padding:"10px",textAlign:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",zIndex:101,animation:"fadeIn 0.3s ease-in-out"},children:(0,e.jsxs)("strong",{children:["⚠️ ",I]})}),v?(0,e.jsx)("div",{className:"loading-container",children:(0,e.jsx)("p",{children:"Loading user settings..."})}):(0,e.jsxs)(e.Fragment,{children:[E&&(0,e.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:100,height:"120px"},children:(0,e.jsx)(m.default,{onButtonClick:a5,onCameraAccess:()=>R(!0),outputText:K||M,onOutputChange:a=>N(a),onToggleTopBar:a=>F(a),onToggleMetrics:()=>P(!O),canvasRef:{current:aW.getCanvas()},showMetrics:O,isTopBarShown:E,isCanvasVisible:aI},`topbar-${E}-${O}`)}),!E&&(0,e.jsx)("div",{className:"restore-button-container",style:{position:"fixed",top:"10px",right:"10px",zIndex:1e3},children:(0,e.jsx)("button",{className:"restore-btn",onClick:()=>F(!0),title:"Show TopBar and Metrics",style:{padding:"5px 10px",background:"#0066cc",color:"white",border:"none",borderRadius:"4px",fontSize:"16px",cursor:"pointer"},children:"≡"})}),(0,e.jsxs)("div",{ref:aQ,className:"camera-preview-area",style:{height:E?"calc(100vh - 120px)":"100vh",marginTop:"disconnected"===C?"32px":"0",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"#f5f5f5",overflow:"hidden",zIndex:1},children:[U?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"camera-preview-message",style:{padding:"20px",textAlign:"center",position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"100%",maxWidth:"600px",zIndex:5,pointerEvents:"none"},children:[(0,e.jsx)("p",{style:{margin:"0 0 10px 0",fontSize:"16px"},children:"Camera preview will appear here"}),(0,e.jsxs)("p",{className:"camera-size-indicator",style:{margin:"0",fontSize:"14px",color:"#666"},children:["Current window: ",ae.percentage,"% of screen width"]}),A&&W&&(0,e.jsx)("div",{className:"camera-placeholder-square",style:{width:"180px",height:"135px",margin:"20px auto",border:"2px dashed #666",borderRadius:"4px",backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:(0,e.jsx)("div",{style:{fontSize:"1.5rem"},children:"\uD83D\uDCF7"})})]}),(0,e.jsx)("div",{className:"canvas-container",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"yellow",overflow:"hidden",border:"none",zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"auto"},children:(0,e.jsx)("div",{id:"canvas-placeholder",style:{width:"100%",height:"100%",backgroundColor:"yellow",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,e.jsx)("p",{style:{color:"#666",fontSize:"14px"},children:"Canvas ready for eye tracking"})})})]}),A&&O&&(0,e.jsx)(n.default,{width:ag.width,height:ag.height,distance:ag.distance,isVisible:O}),console.log("Rendering DisplayResponse, showMetrics:",O,"isHydrated:",A),A&&!1,A&&!1]})]})]})}),y=l()(()=>Promise.resolve(x),{ssr:!1});function t(){return(0,e.jsx)(y,{})}d()}catch(a){d(a)}})},2326:a=>{"use strict";a.exports=require("react-dom")},2729:(a,b,c)=>{"use strict";a.exports=c(3885).vendored.contexts.Loadable},3103:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/add-path-prefix")},3453:(a,b,c)=>{"use strict";c.d(b,{Ls:()=>o,Pt:()=>m,b:()=>n,rd:()=>l,Wj:()=>k}),c(2015),function(){var a=Error("Cannot find module '../../utils/consentManager'");throw a.code="MODULE_NOT_FOUND",a}();let d=()=>{try{let a=Object(function(){var a=Error("Cannot find module '../../utils/consentManager'");throw a.code="MODULE_NOT_FOUND",a}())();if(a)return a;let b=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return console.log("Generated default user ID:",b),b}catch(a){return console.error("Error getting user ID:",a),`user_${Date.now()}`}},e=async(a,b,c,e=null)=>{try{let f=d(),g=await fetch(`/api/user-captures/save/${f}`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY||"your-api-key"},body:JSON.stringify({imageData:a,filename:b,type:c,captureGroup:e})});if(!g.ok){let a=await g.json();throw console.error("Server error:",a),Error(a.detail||`HTTP ${g.status}: ${g.statusText}`)}let h=await g.json();return console.log(`✅ Saved ${c} file for user ${f}:`,h),h}catch(a){throw console.error(`❌ Error saving ${c} file:`,a),a}},f=async(a,b,c=null)=>{try{let e=d(),f=btoa(unescape(encodeURIComponent(a))),g=`data:text/csv;base64,${f}`,h=await fetch(`/api/user-captures/save/${e}`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":process.env.NEXT_PUBLIC_API_KEY||"your-api-key"},body:JSON.stringify({imageData:g,filename:b,type:"parameters",captureGroup:c})});if(!h.ok){let a=await h.json();throw console.error("Server error:",a),Error(a.detail||`HTTP ${h.status}: ${h.statusText}`)}let i=await h.json();return console.log(`✅ Saved CSV file for user ${e}:`,i),i}catch(a){throw console.error(`❌ Error saving CSV file:`,a),a}},g=async({point:a,captureCount:b=1,canvasRef:c,setCaptureCount:g,showCapturePreview:h})=>{try{let b=d();console.log(`Starting user-specific capture for user: ${b}`);let i=`capture-${Date.now()}-${b}`;console.log(`Generated capture group ID: ${i}`);let j=c.current,k=null,l=null,m=null,n=0,o=0;j&&(k=j.toDataURL("image/png"));let p=null,q=window.videoElement||document.querySelector("video");if(q)try{let a=document.createElement("canvas"),b=a.getContext("2d");a.width=q.videoWidth||640,a.height=q.videoHeight||480,n=a.width,o=a.height,b.drawImage(q,0,0,a.width,a.height),l=a.toDataURL("image/jpeg",.95);let c=document.createElement("canvas"),d=c.getContext("2d");c.width=320,c.height=240,d.drawImage(q,0,0,c.width,c.height),p=c.toDataURL("image/jpeg",.8),a.remove(),c.remove()}catch(a){console.error("Error capturing webcam:",a);try{let a=document.createElement("video");a.srcObject=q.srcObject,await a.play();let b=document.createElement("canvas"),c=b.getContext("2d");b.width=q.videoWidth||640,b.height=q.videoHeight||480,n=b.width,o=b.height,c.drawImage(a,0,0,b.width,b.height),l=b.toDataURL("image/jpeg",.95),a.pause(),a.remove(),b.remove()}catch(a){console.error("All webcam capture methods failed:",a),n=640,o=480}}let r=`name,value
user_id,${b}
dot_x,${a.x}
dot_y,${a.y}
canvas_width,${j?.width||0}
canvas_height,${j?.height||0}
window_width,${window.innerWidth}
window_height,${window.innerHeight}
webcam_resolution_width,${n}
webcam_resolution_height,${o}
timestamp,${new Date().toISOString()}
group_id,${i}`,s=await f(r,"parameter_001.csv",i);s&&s.success&&(m=s.number,console.log(`Server assigned capture number: ${m} for group: ${i}`));let t=null;k&&(t=await e(k,"screen_001.jpg","screen",i));let u=null;return l&&(u=await e(l,"webcam_001.jpg","webcam",i)),h&&"function"==typeof h&&h(k,p||l,a),g&&"function"==typeof g&&g(a=>a+1),{success:!0,captureId:i,captureNumber:m,screenImage:k,webcamImage:l,userId:b,results:{parameter:s,screen:t,webcam:u}}}catch(a){throw console.error("❌ Error in captureImagesAtUserPoint:",a),a}},h=()=>({canvasUtils:null,canvasManager:null}),i=()=>{let{canvasUtils:a,canvasManager:b}=h();return a&&"function"==typeof a.getCanvas?a.getCanvas():b&&"function"==typeof b.getCanvas?b.getCanvas()||b.createCanvas():document.querySelector("#tracking-canvas")},j=(a,b,c=12)=>{let{canvasUtils:d}=h();if(d&&"function"==typeof d.drawDot)return d.drawDot(a,b,c);let e=i();return!!e&&(m(e.getContext("2d"),a,b,c,!1),!0)},k=(a,b,c)=>{if(!a&&!b)return;document.querySelectorAll(".capture-preview-container").forEach(a=>{a.parentNode&&a.parentNode.removeChild(a)});let d=document.createElement("div");if(d.className="capture-preview-container",d.style.cssText=`
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    gap: 20px;
    background-color: rgba(0, 0, 0, 0.85);
    padding: 20px;
    border-radius: 12px;
    z-index: 20;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
  `,a){let b=document.createElement("div");b.style.cssText=`
      display: flex;
      flex-direction: column;
      align-items: center;
    `;let c=document.createElement("img");c.src=a,c.alt="Screen Capture",c.style.cssText=`
      max-width: 320px;
      max-height: 240px;
      border: 3px solid white;
      border-radius: 8px;
      background-color: #333;
    `;let e=document.createElement("div");e.textContent="Screen Capture",e.style.cssText=`
      color: white;
      font-size: 14px;
      margin-top: 10px;
      font-weight: bold;
    `,b.appendChild(c),b.appendChild(e),d.appendChild(b)}if(b){let a=document.createElement("div");a.style.cssText=`
      display: flex;
      flex-direction: column;
      align-items: center;
    `;let c=document.createElement("img");c.src=b,c.alt="Webcam Capture",c.style.cssText=`
      max-width: 320px;
      max-height: 240px;
      border: 3px solid white;
      border-radius: 8px;
      background-color: #333;
    `;let e=document.createElement("div");e.textContent="Webcam Capture",e.style.cssText=`
      color: white;
      font-size: 14px;
      margin-top: 10px;
      font-weight: bold;
    `,a.appendChild(c),a.appendChild(e),d.appendChild(a)}if(c){let a=document.createElement("div");a.textContent=c.label?`${c.label}: x=${Math.round(c.x)}, y=${Math.round(c.y)}`:`Point: x=${Math.round(c.x)}, y=${Math.round(c.y)}`,a.style.cssText=`
      color: #ffcc00;
      font-size: 14px;
      position: absolute;
      top: -40px;
      left: 0;
      width: 100%;
      text-align: center;
    `,d.appendChild(a)}let e=document.createElement("div");e.textContent="2.0s",e.style.cssText=`
    position: absolute;
    bottom: -25px;
    right: 20px;
    color: white;
    font-size: 12px;
    background-color: rgba(0, 0, 0, 0.7);
    padding: 3px 8px;
    border-radius: 4px;
  `,d.appendChild(e),document.body.appendChild(d);let f=2,g=setInterval(()=>{(f-=.1)<=0?(clearInterval(g),d.style.opacity="0",d.style.transition="opacity 0.3s ease",setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},300)):e.textContent=`${f.toFixed(1)}s`},100);setTimeout(()=>{d.parentNode&&d.parentNode.removeChild(d)},5e3)},l=async(a,b,c,d)=>{if(!a||"number"!=typeof a.x||"number"!=typeof a.y){console.warn("[runCountdown] Invalid position:",a),c?.({processStatus:"Invalid dot position",countdownValue:null,isCapturing:!1});return}let e=((a,b)=>{if(!a||"number"!=typeof a.x||"number"!=typeof a.y)return console.warn("[createCountdownElement] Invalid position:",a),null;document.querySelectorAll(".calibrate-countdown, .forced-countdown, .center-countdown-backup, .dot-countdown, .test-countdown").forEach(a=>{console.log("Removing existing countdown element:",a),a.parentNode&&a.parentNode.removeChild(a)});let c=i(),d=a;c&&("fixed"===c.style.position&&("100vw"===c.style.width||c.style.width),d={x:a.x,y:a.y}),console.log("[createCountdownElement] Creating countdown at position:",{original:a,display:d,canvasRect:b,canvasFullscreen:!!c&&"fixed"===c.style.position&&"100vw"===c.style.width});let e=document.createElement("div");if(e.className="dot-countdown",e.style.cssText=`
    position: fixed;
    left: ${d.x}px;
    top: ${d.y-80}px;
    transform: translateX(-50%);
    color: red;
    font-size: 64px;
    font-weight: bold;
    text-shadow: 0 0 20px white, 0 0 30px white, 0 0 40px white;
    z-index: 30;
    background-color: rgba(255, 255, 255, 0.98);
    border: 4px solid red;
    border-radius: 50%;
    width: 100px;
    height: 100px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.7), 0 0 50px rgba(255, 0, 0, 0.5);
    animation: countdownPulse 1s infinite;
    pointer-events: none;
    user-select: none;
  `,!document.querySelector("#countdown-styles")){let a=document.createElement("style");a.id="countdown-styles",a.textContent=`
      @keyframes countdownPulse {
        0% { transform: translateX(-50%) scale(1); }
        50% { transform: translateX(-50%) scale(1.1); }
        100% { transform: translateX(-50%) scale(1); }
      }
    `,document.head.appendChild(a)}document.body.appendChild(e),console.log("createCountdownElement created at:",{originalPosition:a,displayPosition:d,canvasRect:b,canvasInfo:c?{position:c.style.position,width:c.style.width,height:c.style.height,rect:c.getBoundingClientRect()}:null});let f=document.createElement("div");return f.style.cssText=`
    position: fixed;
    left: ${d.x}px;
    top: ${d.y}px;
    width: 10px;
    height: 10px;
    background-color: blue;
    border-radius: 50%;
    z-index: 20;
    pointer-events: none;
  `,document.body.appendChild(f),setTimeout(()=>{f.parentNode&&f.parentNode.removeChild(f)},2e3),e})(a,b.getBoundingClientRect());if(!e)return void console.warn("[runCountdown] Countdown element could not be created.");let f=document.querySelector(".backup-countdown");j(a.x,a.y);let g=3;e.textContent=3,f&&(f.textContent=g),c?.({processStatus:"Countdown",countdownValue:g,isCapturing:!0});let h=setInterval(()=>{j(a.x,a.y)},200);return new Promise(b=>{let i=setInterval(()=>{--g<=0?(clearInterval(i),e.textContent="✓",f&&(f.textContent="✓"),c?.({countdownValue:"Capturing...",processStatus:"Capturing image...",isCapturing:!0}),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),f&&f.parentNode&&f.parentNode.removeChild(f),j(a.x,a.y),h&&clearInterval(h),d&&(j(a.x,a.y),d()),b()},300)):(e.textContent=g,f&&(f.textContent=g),c?.({processStatus:"Countdown",countdownValue:g,isCapturing:!0}))},800)})},m=(a,b,c,d=12,e=!0)=>{let f=a.canvas;return e&&(a.clearRect(0,0,f.width,f.height),a.fillStyle="yellow",a.fillRect(0,0,f.width,f.height)),a.beginPath(),a.arc(b,c,d,0,2*Math.PI),a.fillStyle="red",a.fill(),a.beginPath(),a.arc(b,c,d+3,0,2*Math.PI),a.strokeStyle="rgba(255, 0, 0, 0.5)",a.lineWidth=3,a.stroke(),a.beginPath(),a.arc(b,c,d+6,0,2*Math.PI),a.strokeStyle="rgba(255, 0, 0, 0.3)",a.lineWidth=2,a.stroke(),console.log(`Drew red dot at (${b}, ${c}) with radius ${d}`),{x:b,y:c}},n=(a,b=40)=>a?{x:Math.floor(Math.random()*((a.width||400)-2*b))+b,y:Math.floor(Math.random()*((a.height||300)-2*b))+b}:{x:100,y:100},o=async a=>{let{canvasRef:b,position:c,captureCounter:d,setCaptureCounter:e,setProcessStatus:f,toggleTopBar:h,onStatusUpdate:l,captureFolder:m}=a;try{let a=i();if(!a)return console.error("[captureAndPreviewProcess] Canvas reference is null"),f&&f("Error: Canvas is not available"),null;j(c.x,c.y),l&&l({processStatus:"Starting countdown...",isCapturing:!0}),document.querySelectorAll(".calibrate-countdown, .dot-countdown, .forced-countdown, .center-countdown-backup").forEach(a=>{console.log("captureAndPreviewProcess: Removing existing countdown:",a),a.remove()});let m=a.getBoundingClientRect(),n=c;n={x:c.x,y:c.y},console.log("captureAndPreviewProcess: Creating countdown at:",{originalPosition:c,displayPosition:n,canvasRect:m,canvasStyle:{position:a.style.position,width:a.style.width,height:a.style.height}});let o=document.createElement("div");o.className="calibrate-countdown",o.style.cssText=`
      position: fixed;
      left: ${n.x}px;
      top: ${n.y-60}px;
      transform: translateX(-50%);
      color: red;
      font-size: 48px;
      font-weight: bold;
      text-shadow: 0 0 15px white, 0 0 25px white, 0 0 35px white;
      z-index: 30;
      background-color: rgba(255, 255, 255, 0.95);
      border: 3px solid red;
      border-radius: 50%;
      width: 80px;
      height: 80px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5), 0 0 40px rgba(255, 0, 0, 0.3);
      animation: pulse 1s infinite;
    `,document.body.appendChild(o);let p=setInterval(()=>{j(c.x,c.y)},200);for(let a=3;a>0;a--)o.textContent=a,l&&l({processStatus:`Countdown: ${a}`,countdownValue:a,isCapturing:!0}),j(c.x,c.y),await new Promise(a=>setTimeout(a,800));o.textContent="✓",l&&l({processStatus:"Capturing images...",countdownValue:"Capturing...",isCapturing:!0}),setTimeout(()=>{o.parentNode&&o.parentNode.removeChild(o),p&&clearInterval(p)},300);let q=await g({point:c,captureCount:d,canvasRef:b,setCaptureCount:e,showCapturePreview:k});return f&&f(`Captured dot at x=${Math.round(c.x)}, y=${Math.round(c.y)}`),l&&l({processStatus:"Capture complete",isCapturing:!1}),setTimeout(()=>{"function"==typeof h&&h(!0)},2500),q}catch(a){return console.error("[captureAndPreviewProcess] Fatal error:",a),f&&f(`Fatal error: ${a.message}`),setTimeout(()=>{"function"==typeof h&&h(!0)},1500),{screenImage:"",webcamImage:"",success:!1,error:a.message}}}},3873:a=>{"use strict";a.exports=require("path")},4075:a=>{"use strict";a.exports=require("zlib")},5952:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/remove-trailing-slash")},6338:a=>{"use strict";a.exports=import("js-cookie")},6352:(a,b,c)=>{"use strict";c.d(b,{nL:()=>d}),c(2015);let d=(a,b)=>{if(!a||!b||a<=0||b<=0)return console.error("generateCalibrationPoints: Invalid canvas dimensions",{width:a,height:b}),[];let c=(a,b)=>Math.round(a*b),d=c(a,.12),e=a-d,f=c(b,.12),g=b-f,h=c(a,.26),i=a-h,j=c(b,.26),k=b-j,l=Math.floor(a/2),m=Math.floor(b/2);return[{x:d,y:f,label:"Outer Top-Left"},{x:l,y:f,label:"Outer Top-Center"},{x:e,y:f,label:"Outer Top-Right"},{x:d,y:m,label:"Outer Middle-Left"},{x:e,y:m,label:"Outer Middle-Right"},{x:d,y:g,label:"Outer Bottom-Left"},{x:l,y:g,label:"Outer Bottom-Center"},{x:e,y:g,label:"Outer Bottom-Right"},{x:h,y:j,label:"Inner Top-Left"},{x:l,y:j,label:"Inner Top-Center"},{x:i,y:j,label:"Inner Top-Right"},{x:h,y:m,label:"Inner Middle-Left"},{x:i,y:m,label:"Inner Middle-Right"},{x:h,y:k,label:"Inner Bottom-Left"},{x:l,y:k,label:"Inner Bottom-Center"},{x:i,y:k,label:"Inner Bottom-Right"}]}},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},7085:a=>{"use strict";a.exports=require("styled-jsx/style")},7393:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>f});var d=c(8732),e=c(2015);let f=({width:a,height:b,distance:c,isVisible:f=!0})=>{let[g,h]=(0,e.useState)(f?"visible":"hidden");return(0,e.useEffect)(()=>{console.log("DisplayResponse: isVisible changed to",f),h(f?"visible":"hidden")},[f]),console.log("DisplayResponse: rendering with isVisible:",f,"animationState:",g),(0,d.jsxs)("div",{className:`metrics-display ${g}`,style:{position:"absolute",right:"20px",top:"80px",backgroundColor:"rgba(0, 102, 204, 0.8)",color:"white",padding:"10px 15px",borderRadius:"8px",fontSize:"14px",fontFamily:"monospace",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.3)",transition:"all 0.3s ease",opacity:+("visible"===g),transform:"visible"===g?"translateX(0)":"translateX(50px)",pointerEvents:"visible"===g?"auto":"none",zIndex:100},children:[(0,d.jsxs)("div",{className:"metrics-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px",borderBottom:"1px solid rgba(255, 255, 255, 0.3)",paddingBottom:"5px"},children:[(0,d.jsx)("span",{style:{fontWeight:"bold"},children:"Display Metrics"}),(0,d.jsx)("div",{className:"metrics-indicator",style:{width:"10px",height:"10px",borderRadius:"50%",backgroundColor:"#00ff00",boxShadow:"0 0 5px rgba(0, 255, 0, 0.8)"}})]}),(0,d.jsxs)("div",{className:"metrics-content",style:{lineHeight:"1.5"},children:[(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{style:{display:"inline-block",width:"80px"},children:"Width:"}),(0,d.jsx)("span",{style:{fontWeight:"bold"},children:a||"---"}),(0,d.jsx)("span",{style:{opacity:.8,fontSize:"12px"},children:" pixels"})]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{style:{display:"inline-block",width:"80px"},children:"Height:"}),(0,d.jsx)("span",{style:{fontWeight:"bold"},children:b||"---"}),(0,d.jsx)("span",{style:{opacity:.8,fontSize:"12px"},children:" pixels"})]}),(0,d.jsxs)("p",{children:[(0,d.jsx)("span",{style:{display:"inline-block",width:"80px"},children:"Distance:"}),(0,d.jsx)("span",{style:{fontWeight:"bold"},children:c||"---"}),(0,d.jsx)("span",{style:{opacity:.8,fontSize:"12px"},children:" cm"})]})]})]})}},7909:a=>{"use strict";a.exports=require("next/dist/shared/lib/page-path/normalize-data-path")},7910:a=>{"use strict";a.exports=require("stream")},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9501:(a,b,c)=>{a.exports=c(9754)},9754:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{default:function(){return i},noSSR:function(){return h}});let d=c(7020),e=c(8732);c(2015);let f=d._(c(2729));function g(a){return{default:(null==a?void 0:a.default)||a}}function h(a,b){delete b.webpack,delete b.modules;let c=b.loading;return()=>(0,e.jsx)(c,{error:null,isLoading:!0,pastDelay:!1,timedOut:!1})}function i(a,b){let c=f.default,d={loading:a=>{let{error:b,isLoading:c,pastDelay:d}=a;return null}};a instanceof Promise?d.loader=()=>a:"function"==typeof a?d.loader=a:"object"==typeof a&&(d={...d,...a});let e=(d={...d,...b}).loader;return(d.loadableGenerated&&(d={...d,...d.loadableGenerated},delete d.loadableGenerated),"boolean"!=typeof d.ssr||d.ssr)?c({...d,loader:()=>null!=e?e().then(g):Promise.resolve(g(()=>null))}):(delete d.webpack,delete d.modules,h(c,d))}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[6089,7190,9616,5064,7522,7438],()=>b(b.s=1418));module.exports=c})();